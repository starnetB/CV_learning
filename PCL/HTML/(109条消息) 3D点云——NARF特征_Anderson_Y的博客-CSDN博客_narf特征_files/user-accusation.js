"use strict";function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,n){for(var e=0;e<n.length;e++){var s=n[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(n,e,s){return e&&t(n.prototype,e),s&&t(n,s),n}}();!function(t,n){t.csdn=t.csdn||{},function(t){var n=document.createElement("link");n.rel="stylesheet",n.type="text/css",n.href="https://g.csdnimg.cn/user-accusation/1.0.1/user-accusation.css",document.getElementsByTagName("head")[0].appendChild(n)}();var e=function(){function t(n){_classCallCheck(this,t),this.option=n,this.accusationTypeList=[],this.selectId="",this.content="",this.maxlength=200,this.st_timer="",this.init()}return _createClass(t,[{key:"init",value:function(){this.getAccusationOption(),this.showInit()}},{key:"getAccusationOption",value:function(){var t=this,e={type:this.option.type,rtype:this.option.rtype};n.ajax({url:"https://mp-action.csdn.net/interact/wrapper/report/v1/api/getReportContent",type:"get",contentType:"application/json",data:e,dataType:"json",xhrFields:{withCredentials:!0},success:function(n){200===n.code&&(t.accusationTypeList=n.data,t.renderAccusation())},error:function(t){console.log("taodawang err ===>",t)}})}},{key:"renderAccusation",value:function(){var t=this,e=this,s=n('<div class="user-accusation" id="user-accusation">\n        <div class="accusation-back"></div>\n        <div class="accusation-area">\n          <img class="accusation-close" src=https://img-home.csdnimg.cn/images/20210426071127.png />\n          <h1 class="accusation-title">举报反馈</h1>\n          <div class="accusation-type">\n            <h2 class="accusation-secondary-title">举报类型（必选）</h2>\n            <ul>\n              '+this.accusationTypeList.map(function(t){return'<li class="accusation-item" data-content='+t.id+">"+t.content+"</li>"}).join("")+'\n            </ul>\n          </div>\n          <div class="accusation-reason">\n            <h2 class="accusation-secondary-title">举报详情（必填）</h2>\n            '+this.renderTextArea()+'\n          </div>\n          <div class="accusation-btn clearfix">\n            <button class="accusation-send">提交</button>\n            <button class="accusation-cancel">取消</button>\n          </div>\n        </div>\n      </div>');s.on("click",".accusation-close",function(){t.destoryAccusation()}).on("click",".accusation-cancel",function(){t.destoryAccusation()}).on("click",".accusation-send",function(){t.sendAccusationMessage()}).on("click",".accusation-type ul li",function(t){"accusation-item"===t.target.className&&(e.selectId=n(this).attr("data-content"),n(this).hasClass("active")||(n(this).siblings().removeClass("active"),n(this).addClass("active")))}).on("input",".accusation-input > textarea",function(t){e.content=t.target.value,n(".accusation-input > p").text(e.content.length+"/"+e.maxlength)}),n("body").append(s)}},{key:"renderTextArea",value:function(){return'<div class="accusation-input" >\n        <textarea placeholder="请详细描述举报原因，我们将第一时间核实处理" maxlength='+this.maxlength+"/>\n        <p>"+(this.content.length||"0/"+this.maxlength)+"</p>\n      </div>"}},{key:"destoryAccusation",value:function(){n(".user-accusation").remove(),this.destory()}},{key:"sendAccusationMessage",value:function(){if(!this.selectId)return void this.showToast({text:"请选择举报类型",zindex:4e3});if(!this.content)return void this.showToast({text:"请填写举报原因",zindex:4e3});var t=this,e={type:this.option.type,rtype:this.option.rtype,rid:this.option.rid,reportContent:{id:this.selectId},reportedName:this.option.reportedName,supplement:this.content};this.option.submitOptions&&Object.assign(e,this.option.submitOptions),n.ajax({url:"https:///mp-action.csdn.net/interact/wrapper/report/v1/api/addReportResource",type:"post",contentType:"application/json",data:JSON.stringify(e),dataType:"json",xhrFields:{withCredentials:!0},crossDomain:!0,success:function(n){200===n.code&&(t.destoryAccusation(),t.option.callback&&t.option.callback())},error:function(t){console.log("taodawang err ===>",t)}})}},{key:"destory",value:function(){this.accusationTypeList=[],this.selectId="",this.content="",clearTimeout(this.st_timer),n("#report_toastBox").remove()}},{key:"showInit",value:function(){n("<div id='report_toastBox'></div>").appendTo("body").css({width:"100%",position:"fixed",left:"0",bottom:"10%","text-align":"center",display:"none"}),n("<span id='report_toastContent'></span>").appendTo("#report_toastBox").css({color:"#fff",background:"rgba(0,0,0,.8)",padding:"8px 24px","border-radius":"4px","max-width":"80%",display:"inline-block","font-size":"16px"})}},{key:"showToast",value:function(t){clearTimeout(this.st_timer),n("#report_toastBox").hide();var e=t.text,s=parseInt(t.time?t.time:2e3),i=t.speed?t.speed:"normal",a=t.bottom?t.bottom:"10%",o=t.zindex?t.zindex:"4000";n("#report_mask").css({"z-index":o-1}),n("#report_toastBox").css({"z-index":o}),n("#report_toastBox").css({bottom:a}),n("#report_toastContent").text(e),n("#report_toastBox").fadeIn(i),this.st_timer=setTimeout(function(){n("#report_toastBox").fadeOut(function(){})},s)}}]),t}();t.csdn.feedback=function(t){new e(t)}}(window,jQuery);