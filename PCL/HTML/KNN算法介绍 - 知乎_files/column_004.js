(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{1221:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return s}));var o=n(29),a=n(7),r=n.n(a),c=["className","label","tabIndex"];function i(e){return"Enter"===e.key||" "===e.key||"Enter"===e.code||"Space"===e.code||13===e.keyCode||32===e.keyCode}function s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.className,a=t.label,s=void 0===a?"":a,l=t.tabIndex,m=void 0===l?0:l,u=Object(o.default)(t,c);return Object.assign(Object.assign({role:"button",tabIndex:m,onClick:e,onKeyDown:function(t){i(t)&&e(t)},className:r()("a11y-button",n)},s&&{"aria-label":s}),u)}},1228:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var o,a=n(16),r=n(4),c=n(0),i=n(22),s=n(1),l=n(49),m=n(602),u=n(589),d=n(123),p={comment_img:"comment_img",dynamic_top:"dynamic_top",comment_sticker:"comment_sticker",block_keyword:"block_keyword"},h=(o={},Object(r.a)(o,p.comment_img,"https://pic1.zhimg.com/v2-1b6677f81c2df41f55332474e15bc5a8.png"),Object(r.a)(o,p.dynamic_top,"https://pic1.zhimg.com/v2-e16a265a43592abd5b98fceef02a1614.png"),Object(r.a)(o,p.comment_sticker,"https://pic1.zhimg.com/v2-183a98cd480d24cd3e3246ba7a26303b.png"),Object(r.a)(o,p.block_keyword,"https://pic3.zhimg.com/v2-0ad4e8aa43c3279cc7536f2fb7ac8348.png"),o);t.b=Object(u.a)((function(e){var t=e.show,n=e.setShow,o=e.type,r=e.isLogin,u=Object(s.useState)(""),p=Object(a.a)(u,2),b=p[0],f=p[1],v=Object(s.useState)(!1),C=Object(a.a)(v,2),O=C[0],j=C[1],g=Object(d.b)(),y=Object(i.c)((function(){t&&n(!1)}));return Object(s.useEffect)((function(){!b&&r&&(j(!0),g("/api/v4/unlimited/vip_rights/popup?token="+o).then((function(e){f(e.payload.button.text)})).catch((function(){})).then((function(){j(!1)})))}),[t]),Object(c.b)(l.b,{css:{".Modal-content":{padding:0,marginTop:0}},onClose:y,children:t&&!O&&Object(c.c)(c.a,{children:[Object(c.b)("img",{alt:"",src:h[o],css:{height:"230px",width:"400px",display:"block"}}),Object(c.b)("div",{css:{padding:20},children:Object(c.b)("div",{role:"button",tabIndex:0,css:function(e){return{padding:8,background:"linear-gradient(135deg, ".concat(e.colors.GYL06A," 0.2%, ").concat(e.colors.GYL08A," 100%)"),borderRadius:3,textAlign:"center",fontsize:14,color:e.colors.GYL12A,userSelect:"none","&:hover":{cursor:"pointer"}}},onClick:m.a.show,children:b||"开通会员立即解锁"})})]})})}))},1239:function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var o=n(9),a=n(11),r=n(12),c=n(13),i=n(6),s=n(0),l=n(1),m=n.n(l),u=n(2),d=n.n(u),p=n(7),h=n.n(p),b=n(151),f=n(15),v=n(56),C=n(728),O=n(28),j=function(e){return m.a.createElement(O.a,e,m.a.createElement("path",{d:"M13.004 7V4.232c0-.405.35-.733.781-.733.183 0 .36.06.501.17l6.437 5.033c.331.26.376.722.1 1.033a.803.803 0 0 1-.601.264H2.75a.75.75 0 0 1-.75-.75V7.75A.75.75 0 0 1 2.75 7h10.254zm-1.997 9.999v2.768c0 .405-.35.733-.782.733a.814.814 0 0 1-.5-.17l-6.437-5.034a.702.702 0 0 1-.1-1.032.803.803 0 0 1 .6-.264H21.25a.75.75 0 0 1 .75.75v1.499a.75.75 0 0 1-.75.75H11.007z",fillRule:"evenodd"}))};j.defaultProps={name:"Switch"};var g=j;function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var R={normal:{text:"默认排序",value:"reverse"},reverse:{text:"时间排序",value:"normal"}},k=function(e){Object(r.a)(n,e);var t=y(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={text:"时间排序",value:"normal"},e.switchType=function(t){var n=e.state.value,o=e.props.onOrderChange,a=R[n],r=a.text,c=a.value;e.setState({text:r,value:c}),o&&o(c,t)},e}return Object(a.a)(n,[{key:"render",value:function(){var e=this.state.text,t=this.props,n=t.isConversation,o=t.commentClosed;return t.shouldReverse?!n&&!o&&Object(s.b)(f.c,{preset:"plain",onClick:this.switchType,icon:g,label:"切换为".concat(e)}):null}}]),n}(l.Component);k.propTypes={isConversation:d.a.bool,commentClosed:d.a.bool,onOrderChange:d.a.func,shouldReverse:d.a.bool};var I=n(1170);function N(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var w=function(e){Object(r.a)(n,e);var t=N(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props,t=e.commentPattern,n=e.onNavBack;return Object(s.b)("h2",{className:"CommentTopbar-title",children:"bottom"!==t?Object(s.c)(f.c,{className:"CommentTopbar-back",preset:"plain",onClick:n,children:[Object(s.b)(I.a,{text:!0,center:!0})," 返回评论"]}):Object(s.b)("div",{children:"查看对话"})})}}]),n}(l.Component);function S(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}w.propTypes={commentPattern:d.a.string,onNavBack:d.a.func};var P=function(e){Object(r.a)(n,e);var t=S(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).renderTopBarSwitch=function(){var t=e.props,n=t.isMobile,o=t.status,a=t.isConversation,r=t.commentCount,c=t.onOrderChange,i=t.commentClosed,l=t.shouldReverse;return!n&&Boolean(r&&!i)&&"reviewing"!==o&&Object(s.b)(k,{isConversation:a,onOrderChange:c,commentClosed:i,shouldReverse:l})},e}return Object(a.a)(n,[{key:"renderTitle",value:function(){var e=this.props,t=e.commentCount,n=e.commentClosed,o=e.isConversation,a=e.onNavBack,r=e.targetLink,c=e.isCommentReviewer,i=e.reviewingCounts,m=e.onStatusChange,u=e.status,d=e.commentPattern,p=e.isOrg,C=e.isMobile;return o?Object(s.b)(w,{commentPattern:d,onNavBack:a}):c&&!n?Object(s.c)("div",{className:"CommentTopbar-tabsWrapper",children:[Object(s.c)(b.b,{className:"CommentTopbar-tabs",children:[Object(s.b)(b.a,{className:"CommentTopbar-tab","aria-controls":"CommentTopbar-open",meta:Object(v.formatNumber)(t),children:Object(s.b)(f.c,{className:h()("CommentTopbar-tabButton",{"is-active":"open"===u}),onClick:function(){return m("open")},children:"公开评论"})}),!C&&Object(s.b)(b.a,{className:"CommentTopbar-tab","aria-controls":"CommentTopbar-reviewing",meta:void 0===i?null:Object(v.formatNumber)(i),children:Object(s.b)(f.c,{className:h()("CommentTopbar-tabButton",{"is-active":"reviewing"===u}),onClick:function(){return m("reviewing")},children:"待".concat(p?"审核":"筛选","评论")})})]}),r]}):Object(s.b)(l.Fragment,{children:Object(s.c)("h2",{className:"CommentTopbar-title",children:[t&&!n?"".concat(Object(v.formatNumber)(t)," 条评论"):"还没有评论",r]})})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.onRef,o=e.isMobile;return Object(s.b)(C.a,{className:h()("CommentTopbar",t),onRef:n,header:this.renderTitle(),options:this.renderTopBarSwitch(),showOptions:!o})}}]),n}(l.Component);P.propTypes={commentCount:d.a.oneOfType([d.a.number,d.a.string]),isConversation:d.a.bool,onNavBack:d.a.func,isCommentReviewer:d.a.bool,onStatusChange:d.a.func,onOrderChange:d.a.func,status:d.a.string,reviewingCounts:d.a.oneOfType([d.a.number,d.a.string]),targetLink:d.a.node,commentClosed:d.a.bool,commentPattern:d.a.string,isOrg:d.a.bool,isMobile:d.a.bool,options:d.a.element,shouldReverse:d.a.bool},P.defaultProps={shouldReverse:!0}},1241:function(e,t,n){"use strict";var o=n(0),a=n(2),r=n.n(a),c=n(7),i=n.n(c),s=Array.from(Array(12),(function(e,t){return Object(o.b)("span",{className:"Spinner-blade-12"},t)}));function l(e){var t=e.className,n=e.white,a=e.large;return Object(o.b)("div",{className:i()("Spinner-blade",t,{"Spinner-blade--large":a,"Spinner-blade--white":n}),children:s})}l.propTypes={className:r.a.string,large:r.a.bool,white:r.a.bool};var m=l;t.a=m},1248:function(e,t,n){"use strict";var o=n(16),a=n(0),r=n(1),c=n(80),i=n.n(c),s=n(8),l=n(413),m=Object(s.connect)((function(e){return{hasData:e.emoticons.emoticonGroupList.length>0}}));t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.alwaysShow,n=void 0!==t&&t;return function(e){return m(i()((function(t){var c=t.hasData,i=Object(r.useState)(!1),m=Object(o.a)(i,2),u=m[0],d=m[1],p=Object(s.useDispatch)();return Object(r.useEffect)((function(){c?d(!0):p(Object(l.d)()).then((function(e){var t=e.payload.data[0].id;p(Object(l.e)(t)),d(!0)})).catch((function(){d(!0)}))}),[p,c]),(!u||!n)&&Object(a.b)(e,Object.assign({},t))}),e))}}},1261:function(e,t,n){"use strict";var o=n(9),a=n(11),r=n(12),c=n(13),i=n(6),s=n(0),l=n(1),m=n(8),u=n(30),d=n(2),p=n.n(d),h=n(7),b=n.n(h),f=n(420),v=n.n(f),C=n(22),O=n(18),j=n(413),g=n(44),y=n(97),R=n(1228),k=n(16),I=n(293);function N(e){var t,n,o,a,r,c,i,m,u,d=e.className,p=e.emoticonGroupList,h=e.curEmoticonGroupId,f=e.onGroupSelected,v=e.vipEnabled,O=Object(l.useRef)(),j=Object(I.a)(v,p),g=(t=O,n=Object(l.useState)({left:null,x:null}),o=Object(k.a)(n,2),a=o[0],r=o[1],c=Object(l.useState)(!1),i=Object(k.a)(c,2),m=i[0],u=i[1],{onMouseDown:Object(C.c)((function(e){var n;u(!0);var o=null===(n=t.current)||void 0===n?void 0:n.scrollLeft,a=e.clientX;r({left:o,x:a}),e.preventDefault()})),onMouseMove:Object(C.c)((function(e){if(m){var n=e.clientX-a.x;t.current&&(t.current.scrollLeft=a.left-n)}})),onMouseUp:Object(C.c)((function(){m&&u(!1)}))});return Object(s.b)("div",{className:b()("EmoticonsFooter",d),children:Object(s.b)("ul",Object.assign(Object.assign({className:"EmoticonsFooter-items",ref:O},g),{},{children:j.map((function(e){return Object(s.b)("li",{className:b()("EmoticonsFooter-item",{"EmoticonsFooter-item--selected":h===e.id}),onClick:function(){f(e.id)},children:Object(s.b)("img",{alt:"",src:e.iconUrl,className:"EmoticonsFooter-itemIcon"})},e.id)}))}))})}var w=n(1241);function S(e){var t=e.item,n=e.type,o=e.onSelectEmoticon,a=t.title,r=t.staticImageUrl,c=t.dynamicImageUrl,i=function(e){c&&(e.target.src=c)},l=function(e){c&&(e.target.src=r)},m=function(){o(t,n)};return Object(s.c)(O.a,{zaType:"Button",zaText:a,zaEventType:"Click",zaBlock:"vip"===n?"VipEmoticon":"Emoticon",as:"li",className:b()("EmoticonPanel-item",{"EmoticonPanel-item--big":"emoji"!==n}),onClick:m,onKeyPress:function(e){" "===e.key&&m()},tabIndex:0,children:[Object(s.b)("img",{src:r,title:"emoji"===n?a:"",className:b()({"EmoticonPanel-itemImg--small":"emoji"===n,"EmoticonPanel-itemImg--big":"emoji"!==n}),onMouseOver:i,onMouseOut:l,onFocus:i,onBlur:l,alt:a}),"emoji"!==n&&Object(s.b)("span",{className:"EmoticonPanel-itemTitle",children:a})]})}function P(e){var t=e.type,n=e.data,o=void 0===n?[]:n,a=e.onSelectEmoticon;return 0===o.length?Object(s.b)(w.a,{className:"EmoticonPanel-spinner"}):Object(s.b)("ul",{className:"EmoticonPanel",children:o.map((function(e){return Object(s.b)(S,{item:e,type:t,onSelectEmoticon:a},e.id)}))})}function E(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}P.propTypes={type:p.a.string.isRequired,data:p.a.array.isRequired,onSelectEmoticon:p.a.func.isRequired};var T=function(e){Object(r.a)(n,e);var t=E(n);function n(){var e;Object(o.a)(this,n);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).getCurEmoticonGroupPanleData=function(){var t=e.props,n=t.curEmoticonGroupId;return t.emoticonPanelList.filter((function(e){return e.groupId===n}))},e}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props,t=e.changeSelectedEmoticonPanel,n=e.curEmoticonPanelId,o=e.className,a=this.getCurEmoticonGroupPanleData();return a.length<=1?null:Object(s.b)("ul",{className:b()("EmoticonPagination",o),children:a.map((function(e){return Object(s.b)("li",{className:b()("EmoticonPagination-bullet",{"EmoticonPagination-bullet--active":e.id===n}),onClick:function(){t(e.id)}},e.id)}))})}}]),n}(l.Component);T.propsTypes={className:p.a.string};var B=Object(m.connect)((function(e){var t=e.emoticons;return{curEmoticonGroupId:t.curEmoticonGroupId,emoticonPanelList:t.emoticonPanelList,curEmoticonPanelId:t.curEmoticonPanelId}}),{changeSelectedEmoticonPanel:j.b})(T),L=n(4),x=n(585),z=n(36);function D(e){var t=e.show,n=e.onClick,o=Object(C.c)((function(){null==n||n()}));return t&&Object(s.c)(O.a,{zaType:"Button",zaEventType:"Click",zaAction:"OpenUrl",zaBlock:"VipBrand",extra:{link:{url:z.w}},css:function(e){return Object(L.a)({backgroundColor:e.colorMod(e.colors.GYL08A).alpha(.25),color:e.colors.GYL12A,display:"flex",alignItems:"center",justifyContent:"center",height:"25px",fontSize:"12px",lineHeight:"17px",userSelect:"none"},"&:hover",{cursor:"pointer"})},onClick:o,children:["开通会员解锁全部会员表情 ",Object(s.b)(x.a,{})]})}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var A={containerClass:"Emoticons-panelContainer",ContainerEl:"ul",threshold:10},V=function(e){Object(r.a)(n,e);var t=M(n);function n(e){var a;return Object(o.a)(this,n),(a=t.call(this,e)).state={showVipStickerModal:!1},a.setShowVipStickerModal=function(e){a.setState({showVipStickerModal:e})},a.handleGetSwiperInstance=function(e){a.mousetrap=new v.a,a.swiperInstance=e,a.mousetrap.bind("left",(function(){e.slidePrev()})),a.mousetrap.bind("right",(function(){e.slideNext()}))},a.handleEmoticonGroupSelected=function(e){var t=a.props,n=t.getEmoticonsDetail,o=t.emoticonGroupDetail,r=t.changeSelectedEmoticonGroup,c=t.changeSelectedEmoticonPanel;o[e]||n(e),r(e),c("".concat(e,"-0"))},a.handleSlideChange=function(){var e=a.props,t=e.emoticonPanelList,n=e.getEmoticonsDetail,o=e.changeSelectedEmoticonPanel,r=e.changeSelectedEmoticonGroup;if(a.swiperInstance){var c=t[a.swiperInstance.activeIndex];o(c.id),r(c.groupId),0===c.data.length&&n(c.groupId)}},a.handleRequestVip=function(){a.setShowVipStickerModal(!0)},a.handleSelectEmoticon=function(e,t){var n=a.props,o=n.onSelectEmoticon,r=n.isVip;"vip"!==t||r?o(e,t):a.handleRequestVip()},a.swiperInstance=Object(l.createRef)(),a}return Object(a.a)(n,[{key:"componentWillUnmount",value:function(){var e=this.props,t=e.changeSelectedEmoticonGroup,n=e.changeSelectedEmoticonPanel,o=e.emoticonPanelList;t(o[0].groupId),n(o[0].id),this.mousetrap.reset()}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.emoticonGroupList,a=void 0===o?[]:o,r=t.curEmoticonGroupId,c=t.emoticonPanelList,i=t.curEmoticonPanelId,l=t.isVip,m=t.vipEnabled,u=void 0!==m&&m,d=t.Swiper,p=this.state.showVipStickerModal,h=this.setShowVipStickerModal,f=Object(I.a)(u,c);return Object(s.b)(O.b,{block:"EmoticonsCard",children:Object(s.c)("div",{className:b()("Emoticons",n),children:[d?Object(s.b)(d,Object.assign(Object.assign({},A),{},{activeSlideKey:i,getSwiper:this.handleGetSwiperInstance,on:{slideChange:this.handleSlideChange},children:f.map((function(t){return Object(s.b)("li",{className:"Emoticons-panels-item",children:Object(s.b)(P,{type:t.type,data:t.data,onSelectEmoticon:e.handleSelectEmoticon})},t.id)}))})):Object(s.b)("div",{css:{height:183}}),Object(s.b)(B,{className:"Emoticons-Pagination"}),Object(s.b)(D,{show:u&&!l,onClick:this.handleRequestVip}),Object(s.b)(N,{emoticonGroupList:a,curEmoticonGroupId:r,onGroupSelected:this.handleEmoticonGroupSelected,vipEnabled:u}),Object(s.b)(R.b,{show:p,setShow:h,type:R.a.comment_sticker})]})})}}]),n}(l.Component);V.propTypes={className:p.a.string,onSelectEmoticon:p.a.func};t.a=Object(u.compose)(Object(m.connect)((function(e){var t=e.emoticons,n=t.emoticonGroupList,o=t.curEmoticonGroupId,a=t.emoticonGroupDetail,r=t.emoticonPanelList;return{emoticonGroupList:n,curEmoticonGroupId:o,emoticonGroupDetail:a,emoticonPanelList:void 0===r?[]:r,curEmoticonPanelId:t.curEmoticonPanelId,isVip:Object(g.i)(e)}}),{getEmoticonsDetail:j.e,changeSelectedEmoticonGroup:j.a,changeSelectedEmoticonPanel:j.b}),Object(y.a)(null),(function(e){return function(t){var o=Object(C.d)((function(){return Promise.all([n.e(24),n.e(31)]).then(n.t.bind(null,1538,7))}));return Object(s.b)(e,Object.assign(Object.assign({},t),{},{Swiper:o}))}}))(V)},1262:function(e,t,n){"use strict";var o=n(16),a=n(0),r=n(80),c=n.n(r),i=n(19),s=n(293),l=n(14),m=n(164);function u(e){return e.reduce((function(e,t){var n;return[].concat(Object(l.a)(e),Object(l.a)(null!==(n=t.stickers)&&void 0!==n?n:[]))}),[])}var d=function(){return window.zh_emoticon?Promise.resolve(u(window.zh_emoticon)):Object(m.loadScript)("https://unpkg.zhimg.com/@cfe/emoticon@1.2.2/lib/emoticon.js").then((function(){return window.zh_emoticon?u(window.zh_emoticon):[]}))},p=n(1);t.a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.alwaysShow,n=void 0!==t&&t;return function(e){return c()((function(t){var r=Object(p.useState)(!1),c=Object(o.a)(r,2),l=c[0],m=c[1];return Object(p.useEffect)((function(){Object(s.c)()?m(!0):d().then((function(e){Object(s.e)(Object(i.camelizeKeys)(e)),m(!0)})).catch((function(){m(!0)}))}),[]),(l||n)&&Object(a.b)(e,Object.assign({},t))}),e)}}},1313:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var o=n(23),a=n.n(o),r=n(25),c=n.n(r),i=n(26),s=n.n(i),l=n(31),m=n.n(l),u=n(17),d=n.n(u),p=n(73),h=n.n(p),b=n(1),f=n(7),v=n.n(f),C=n(15),O=n(3);function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=d()(e);if(t){var a=d()(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return m()(this,n)}}var g=function(e){s()(n,e);var t=j(n);function n(){var e;a()(this,n);for(var o=arguments.length,r=new Array(o),c=0;c<o;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).handleClick=function(){var t=e.props;(0,t.onSelect)(t.page)},e}return c()(n,[{key:"render",value:function(){var e=this.props,t=e.text,n=e.isCurrent,o=e.className;return Object(O.f)(C.c,{preset:C.b.Plain,className:v()("PaginationButton",{"PaginationButton--current":n},o),onClick:this.handleClick,disabled:n},t)}}]),n}(b.Component);function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=d()(e);if(t){var a=d()(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return m()(this,n)}}var R=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Array.from({length:t},(function(t,n){return n+e}))},k=function(e){s()(n,e);var t=y(n);function n(){return a()(this,n),t.apply(this,arguments)}return c()(n,[{key:"render",value:function(){var e,t=this.props,n=t.onSelect,o=t.className,a=t.clickCallback,r=this.props.current,c=this.props.total,i=a&&(e=a,function(){e.apply(void 0,arguments)})||n,s=function(e,t){var n="...";return t<=5?R(1,t):e>t-3?[1,n].concat(h()(R(t-3,3)),[t]):e<=3?[1].concat(h()(R(2,3)),[n,t]):[1,n].concat(h()(R(e-Math.floor(1.5),3)),[n,t])}(r,c);return Object(O.f)("div",{className:v()("Pagination",o)},r>1&&r<=c&&Object(O.f)(g,{className:"PaginationButton-prev",onSelect:i,text:"上一页",page:r-1}),s.map((function(e,t){return"number"==typeof e?Object(O.f)(g,{onSelect:i,text:e,page:e,key:t,isCurrent:r===e}):Object(O.f)("button",{disabled:!0,key:t,className:"PaginationButton PaginationButton--ellipsis"},e)})),r>0&&r<c&&Object(O.f)(g,{className:"PaginationButton-next",onSelect:i,text:"下一页",page:r+1}))}}]),n}(b.Component);k.defaultProps={current:1,total:1,onSelect:function(){}}},1316:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var o=n(9),a=n(11),r=n(12),c=n(13),i=n(6),s=n(0),l=n(1),m=n(147);function u(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(i.a)(e);if(t){var a=Object(i.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(c.a)(this,n)}}var d=function(e){Object(r.a)(n,e);var t=u(n);function n(){return Object(o.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e=this.props.onRef;return Object(s.b)("div",{className:"Comments-pattern-loading",ref:e,children:Object(s.b)(m.a,{})})}}]),n}(l.PureComponent)},1317:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var o=n(16),a=n(0),r=n(1),c=n(257),i=n(785),s=n(127),l=n.n(s);function m(e){var t=e.onClick,n=e.commentsElRef,s=Object(r.useState)(!1),m=Object(o.a)(s,2),u=m[0],d=m[1],p=Object(r.useState)(0),h=Object(o.a)(p,2),b=h[0],f=h[1];return Object(r.useEffect)((function(){var e=n.current;if(e){var t=e.getBoundingClientRect().right;f(t-16)}}),[n]),Object(r.useEffect)((function(){var e=l()((function(){var e=n.current;if(e){var t=window.innerHeight,o=e.getBoundingClientRect(),a=o.top,r=o.bottom,c=o.height;d(c>500&&r>t&&a<0)}}),100);return window.addEventListener("scroll",e),function(){e.cancel(),window.removeEventListener("scroll",e)}}),[n]),Object(c.c)(u,null,{from:{opacity:0,left:b},enter:{opacity:1,left:b},leave:{opacity:0,left:b}}).map((function(e){var n=e.item,o=e.key,r=e.props;return n&&Object(a.c)(c.a.button,{style:r,onClick:t,className:"CommentCollapseButton",children:["收起评论",Object(a.b)(i.a,{center:!0})]},o)}))}},1326:function(e,t,n){"use strict";var o=n(1),a=n.n(o),r=n(28),c=function(e){return a.a.createElement(r.a,e,a.a.createElement("path",{d:"M1 11.5C1 15 7 19 12 19s11-4 11-7.5S17 4 12 4 1 8 1 11.5zm11 5c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm-3-5c0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3-3 1.34-3 3z",fillRule:"evenodd"}))};c.defaultProps={name:"Eye"},t.a=c},1413:function(e,t,n){"use strict";var o=n(1),a=n.n(o),r=n(28),c=function(e){return a.a.createElement(r.a,e,a.a.createElement("path",{d:"M13.25 5.5H6.868c-.755 0-1.368.613-1.368 1.368v10.264c0 .755.613 1.368 1.368 1.368h10.264c.755 0 1.368-.613 1.368-1.368V10.75H20v6.467A2.783 2.783 0 0 1 17.217 20H6.783A2.783 2.783 0 0 1 4 17.217V6.783A2.783 2.783 0 0 1 6.783 4h6.467v1.5zM8.158 13.4a1.033 1.033 0 0 1 1.744-.078l.258.37a.782.782 0 0 0 1.303-.031l1.332-2.113a1.173 1.173 0 0 1 2.01.043l2.03 3.537A1.25 1.25 0 0 1 15.748 17H8.25a1.252 1.252 0 0 1-1.085-1.873l.992-1.728zM9.5 11a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm3.75-5.5a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5zM18.5 4V2.25a.75.75 0 1 1 1.5 0V4h1.75a.75.75 0 1 1 0 1.5H20v1.75a.75.75 0 1 1-1.5 0V5.5h-1.75a.75.75 0 1 1 0-1.5h1.75zm.75 7.5a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5z"}))};c.defaultProps={name:"AddImage"},t.a=c},1414:function(e,t,n){"use strict";var o=n(1),a=n.n(o),r=n(28),c=function(e){return a.a.createElement(r.a,e,a.a.createElement("path",{d:"M7.523 13.5h8.954c-.228 2.47-2.145 4-4.477 4-2.332 0-4.25-1.53-4.477-4zM12 21a9 9 0 1 1 0-18 9 9 0 0 1 0 18zm0-1.5a7.5 7.5 0 1 0 0-15 7.5 7.5 0 0 0 0 15zm-3-8a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm6 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"}))};c.defaultProps={name:"Emotion"},t.a=c},1444:function(e,t,n){"use strict";var o=n(1),a=n.n(o),r=n(28),c=function(e){return a.a.createElement(r.a,e,a.a.createElement("path",{d:"M16.464 4s.051-2-1.479-2H9C7.194 2 7.465 4 7.465 4H4.752c-2.57 0-2.09 3.5 0 3.5l1.213 13.027S5.965 22 7.475 22h8.987c1.502 0 1.502-1.473 1.502-1.473l1.2-13.027c2.34 0 2.563-3.5 0-3.5h-2.7zM8.936 18.5l-.581-9h1.802v9H8.936zm4.824 0v-9h1.801l-.61 9H13.76z",fillRule:"evenodd"}))};c.defaultProps={name:"Trash"},t.a=c},1456:function(e,t,n){var o=n(788),a=n(325),r=n(417),c=Math.max,i=Math.min;e.exports=function(e,t,n){var s=null==e?0:e.length;if(!s)return-1;var l=s-1;return void 0!==n&&(l=r(n),l=n<0?c(s+l,0):i(l,s-1)),o(e,a(t,3),l,!0)}},1536:function(e,t,n){"use strict";var o=n(1),a=n.n(o),r=n(28),c=function(e){return a.a.createElement(r.a,e,a.a.createElement("path",{d:"M22.959 17.22c-1.686-3.552-5.128-8.062-11.636-8.65-.539-.053-1.376-.436-1.376-1.561V4.678c0-.521-.635-.915-1.116-.521L1.469 10.67a1.506 1.506 0 0 0-.1 2.08s6.99 6.818 7.443 7.114c.453.295 1.136.124 1.135-.501V17a1.525 1.525 0 0 1 1.532-1.466c1.186-.139 7.597-.077 10.33 2.396 0 0 .396.257.536.257.892 0 .614-.967.614-.967z",fillRule:"evenodd"}))};c.defaultProps={name:"Reply"},t.a=c},1543:function(e,t,n){"use strict";n.r(t);var o=n(29),a=n(9),r=n(11),c=n(12),i=n(13),s=n(6),l=n(0),m=n(1),u=n.n(m),d=n(2),p=n.n(d),h=n(52),b=n(8),f=n(30),v=n(7),C=n.n(v),O=n(414),j=n(1456),g=n.n(j),y=n(92),R=n(1313),k=n(56),I=n(39),N=n(62),w=n(149),S=n(44),P=n(98),E=n(590),T=n(1262),B=n(293),L=function(e){return Object.assign(Object.assign({},e),{},{richText:Object(B.d)(e.content)})},x=n(115),z=n(14),D=n(63),M=n(47),A=n(10),V=n(18),F=n(102),_=n.n(F),q=n(46),U=n.n(q),H=n(15),G=n(446),W=n(129),K=n(1248),Y=n(334),J=n(16),X=n(50),Z=n.n(X),Q=n(155),$=n(165),ee=n(606),te=n(783),ne=n(1413),oe=n(22),ae=n(1228),re=n(274),ce=n(589),ie=n(36),se="zhihu::comment_local_key",le=(ie.H,function(){return""}),me="上传失败",ue="上传中",de="",pe="emoticon",he="selected",be="image",fe=Object(m.forwardRef)((function(e,t){var n=e.children,o=Object(m.useRef)(!1),a=Object(m.useRef)(null),r=Object(m.useRef)(null),c=Object(m.useRef)(null),i=Object(oe.c)((function(){var e,t,n;null===(e=a.current)||void 0===e||e.position(),null===(t=r.current)||void 0===t||t.position(),null===(n=c.current)||void 0===n||n.position()})),s=Object(oe.c)((function(){var e;null===(e=a.current)||void 0===e||e.open()})),l=Object(oe.c)((function(){var e,t,n;null===(e=c.current)||void 0===e||e.open(),null===(t=r.current)||void 0===t||t.close(),null===(n=a.current)||void 0===n||n.close()})),u=Object(oe.c)((function(){var e;null===(e=c.current)||void 0===e||e.close()})),d=Object(oe.c)((function(){var e,t,n;null===(e=r.current)||void 0===e||e.open(),null===(t=c.current)||void 0===t||t.close(),null===(n=a.current)||void 0===n||n.close()})),p=Object(oe.c)((function(){var e;null===(e=r.current)||void 0===e||e.close()})),h=Object(oe.c)((function(){var e,t,n;null===(e=c.current)||void 0===e||e.close(),null===(t=r.current)||void 0===t||t.close(),null===(n=a.current)||void 0===n||n.close()})),b=Object(oe.c)((function(){var e,t;o.current||(o.current=!0,null===(e=r.current)||void 0===e||e.open(),null===(t=c.current)||void 0===t||t.open(),Promise.resolve().then((function(){var e,t;null===(e=r.current)||void 0===e||e.close(),null===(t=c.current)||void 0===t||t.close()})))})),f=Object(m.useState)({register:function(e,t){e===pe&&(a.current=t),e===he&&(r.current=t),e===be&&(c.current=t)},position:i,openEmoticon:s,openImage:l,openSelected:d,closeImage:u,closeSelected:p,closeAll:h,prepare:b}),v=Object(J.a)(f,1)[0];return Object(m.useImperativeHandle)(t,(function(){return v})),n&&n.map((function(e){return Object(m.cloneElement)(e,{popoversController:v})}))})),ve=n(69),Ce=Object.assign;var Oe=function(e){return u.a.createElement(ve.a,Ce({width:"21",height:"14",fill:"none"},e),u.a.createElement("path",{fill:"url(#A)",stroke:"#f6f6f6",d:"M7.486.504a6 6 0 100 12h7a6 6 0 100-12h-7z"}),u.a.createElement("g",{fill:"#935d14"},u.a.createElement("path",{d:"M8.459 9.431l2.465-5.366h-.916L8.401 7.751l-1.6-3.687h-.923L8.35 9.431h.109zm3.825 0V4.065h-.814v5.366h.814zm2.05 0V7.445h.284c.659 0 1.156-.153 1.491-.46s.502-.747.502-1.321c0-.496-.154-.887-.462-1.172s-.794-.427-1.458-.427h-1.178v5.366h.822zm.305-2.708h-.305V4.78h.378c.388 0 .664.09.829.27s.247.414.247.701c0 .268-.085.496-.254.686s-.468.285-.894.285z",fillRule:"evenodd"}),u.a.createElement("path",{d:"M8.459 9.431v.146h.094l.039-.085-.133-.061zm2.465-5.366l.133.061.095-.207h-.228v.146zm-.916 0v-.146h-.096l-.038.088.134.058zM8.401 7.751l-.134.058.134.309.134-.309-.134-.058zm-1.6-3.687l.134-.058-.038-.088h-.096v.146zm-.923 0v-.146h-.229l.096.208.133-.061zM8.35 9.431l-.133.061.039.085h.094v-.146zm3.934 0v.146h.146v-.146h-.146zm0-5.366h.146v-.146h-.146v.146zm-.814 0v-.146h-.146v.146h.146zm0 5.366h-.146v.146h.146v-.146zm2.865 0v.146h.146v-.146h-.146zm0-1.986v-.146h-.146v.146h.146zm-.822-3.38v-.146h-.146v.146h.146zm0 5.366h-.146v.146h.146v-.146zm.822-2.708h-.146v.146h.146v-.146zm0-1.942v-.146h-.146v.146h.146zM8.592 9.492l2.465-5.366-.266-.122L8.326 9.37l.266.122zm2.332-5.573h-.916v.293h.916v-.293zm-1.05.088L8.267 7.693l.268.117 1.607-3.687-.268-.117zM8.535 7.693l-1.6-3.687-.269.116 1.6 3.687.268-.116zM6.801 3.918h-.923v.293h.923v-.293zm-1.056.208l2.472 5.366.266-.122-2.472-5.366-.266.122zM8.35 9.577h.109v-.293H8.35v.293zm4.08-.146V4.065h-.293v5.366h.293zm-.146-5.512h-.814v.293h.814v-.293zm-.961.146v5.366h.293V4.065h-.293zm.146 5.512h.814v-.293h-.814v.293zm3.011-.146V7.445h-.293v1.986h.293zm-.146-1.839h.284v-.293h-.284v.293zm.284 0c.68 0 1.218-.158 1.589-.498l-.198-.216c-.297.273-.753.421-1.392.421v.293zm1.589-.498c.372-.341.549-.826.549-1.429h-.293c0 .545-.158.942-.454 1.214l.198.216zm.549-1.429c0-.529-.166-.962-.509-1.279l-.199.215c.272.252.415.6.415 1.064h.293zm-.509-1.279c-.347-.321-.877-.466-1.557-.466v.293c.648 0 1.09.14 1.358.388l.199-.215zM14.69 3.92h-1.178v.293h1.178V3.92zm-1.324.146v5.366h.293V4.065h-.293zm.146 5.512h.822v-.293h-.822v.293zm1.127-3.001h-.305v.293h.305v-.293zm-.159.146V4.78h-.293v1.942h.293zm-.146-1.796h.378v-.293h-.378v.293zm.378 0c.37 0 .597.087.721.223l.216-.198c-.205-.224-.532-.318-.937-.318v.293zm.721.223c.136.148.209.345.209.602h.293c0-.317-.092-.588-.286-.8l-.216.198zm.209.602a.85.85 0 01-.217.589l.218.195a1.14 1.14 0 00.292-.784h-.293zm-.217.589c-.128.143-.373.236-.785.236v.293c.441 0 .792-.097 1.003-.334l-.218-.195z"})),u.a.createElement("defs",null,u.a.createElement("linearGradient",{id:"A",x1:"1.986",x2:"19.986",y1:"12.004",y2:"12.004",gradientUnits:"userSpaceOnUse"},u.a.createElement("stop",{stopColor:"#f8e2c4"}),u.a.createElement("stop",{offset:"1",stopColor:"#f3bb6c"}))))},je=["showVipBadge"];function ge(e){var t=e.images,n=e.onClick,o=e.onReset,a=Object(m.useState)(!1),r=Object(J.a)(a,2),c=r[0],i=r[1],s=Object(oe.c)((function(){return i(!0)})),u=Object(oe.c)((function(){return i(!1)}));return Object(l.c)(m.Fragment,{children:[Object(l.c)("div",{onMouseEnter:s,onMouseLeave:u,css:{width:"110px",height:"110px",position:"relative",display:"flex",alignItems:"center",justifyContent:"center"},children:[Object(l.b)("img",{src:t[0].src,alt:""}),c&&Object(l.b)(ye,{onClick:n})]}),Object(l.b)("div",{className:"closeButton",onClick:o,css:function(e){return{color:e.colors.GBK06A}},children:Object(l.b)(te.a,{})})]})}function ye(e){var t=e.onClick;return Object(l.b)("div",{role:"button",tabIndex:0,css:{position:"absolute",width:"100%",height:"100%",backgroundColor:"rgba(0,0,0,0.3)",display:"flex",alignItems:"center",justifyContent:"center",userSelect:"none",borderRadius:"4px","&:hover":{cursor:"pointer"}},onClick:t,children:Object(l.b)("div",{css:function(e){return{color:e.colors.GBK99B,lineHeight:"27px",width:"74px",borderRadius:"20px",borderColor:"#fefefe",borderWidth:"1px",borderStyle:"solid",fontSize:"12px",textAlign:"center"}},children:"更换图片"})})}var Re=Object(m.forwardRef)((function(e,t){var n=e.showVipBadge,a=Object(o.default)(e,je);return Object(l.b)(V.a,Object.assign({as:$.a,zaType:"Button",zaEventType:"Click",zaBlock:"AppendImage",label:"插入图片",ref:t,icon:Object(l.c)(m.Fragment,{children:[Object(l.b)(ne.a,{}),n&&Object(l.b)(Oe,{css:{position:"absolute",transform:"translate(10px, -6.5px)",width:"20px",height:"13px"}})]})},a))})),ke=Object(f.compose)(Object(b.connect)((function(e){return{isVip:Object(S.i)(e)}}),{showNotification:I.g,uploadImage:re.b}),ce.a)((function(e){var t=e.popoversController,n=Object(m.useState)(de),o=Object(J.a)(n,2),a=o[0],r=o[1],c=Object(m.useState)(!1),i=Object(J.a)(c,2),s=i[0],u=i[1],d=Object(m.useRef)();Object(m.useEffect)((function(){t.register(be,d.current)}),[t]);var p=Object(m.useRef)(),h=Object(oe.c)((function(t){t.preventDefault(),(0,e.authRequired)((function(){var t,n=e.handleInputActive;e.hasPermission?(null===(t=p.current)||void 0===t||t.click(),n(!0)):u(!0)}))()})),b=function(){p.current&&(p.current.value=null)},f=function(){var t=e.handleImages,n=e.showNotification,o=e.resetUploadImg;t([]),n("图片上传失败","red"),o(),r(me)},v=function(t){var n=e.handleImages,o=e.updatePublishStatus;n([Object.assign(Object.assign({},t.payload),{},{url:t.payload.src})]),o(!1),b(),r(de)},C=Object(oe.c)((function(n){var o=e.showNotification;return n?n.size>1024*ie.H*1024?(o("请上传小于 ".concat(ie.H,"M 的图片。"),"red"),b(),!1):(t.openImage(),void r(ue)):(b(),!1)})),O=Object(oe.c)((function(t){var n=t.file;return(0,e.uploadImage)(n).then(v).catch(f)})),j=Object(oe.c)((function(){var n=e.resetUploadImg,o=void 0===n?Z.a:n;t.closeImage(),o()})),g=e.images,y=e.disableButton,R=e.hasPermission,k=e.onPopoverOpen,I=e.isVip,N=Boolean(g.length)&&a===de,w=I||!R;return Object(l.c)(m.Fragment,{children:[Object(l.b)(Q.a,{className:"ImagePopover",arrowed:!0,ref:d,placement:"bottom",globalClose:!g.length,onOpen:k,onClick:h,toggler:Object(l.b)(Re,{disabled:y,showVipBadge:w}),children:Object(l.c)("div",{className:"ImagePopover-thumbnail",children:[N&&Object(l.b)(ge,{images:g,onClick:h,onReset:j}),a&&!N&&Object(l.b)("p",{className:"ImagePopover-uplodaStatus",children:a})]})}),Object(l.b)(ee.a,{accept:"image/png,image/jpeg",onRef:p,beforeUpload:C,customUpload:O}),Object(l.b)(ae.b,{show:s,setShow:u,type:ae.a.comment_img})]})})),Ie=n(67);function Ne(e){var t=e.onClose,n=e.onSubmit;return Object(l.c)(Ie.b,{className:"CommentCheckModal-wrapper",onClose:t,children:[Object(l.b)("div",{className:"CommentCheckModal-image"}),Object(l.b)("div",{className:"CommentCheckModal-title",children:"评论可能包含不友善内容"}),Object(l.b)("div",{className:"CommentCheckModal-content",children:"友善的交流是沟通的起点，请遵守知乎社区规范，认真友善发言"}),Object(l.c)("div",{className:"CommentCheckModal-button",children:[Object(l.b)(H.c,{className:"CommentCheckModal-submit",onClick:n,preset:"primary",children:"继续发布"}),Object(l.b)(H.c,{className:"CommentCheckModal-modify",onClick:t,preset:"primary",color:"blue",children:"返回修改"})]})]})}var we=function(e){var t=e.url,n=e.title,o=e.onReset,a=void 0===o?Z.a:o,r=e.popoversController,c=Object(m.useRef)();Object(m.useEffect)((function(){r.register(he,c.current)}),[r]);var i=Object(oe.c)((function(){r.closeSelected(),a()}));return Object(l.b)(Q.a,{arrowed:!0,globalClose:!1,ref:c,preventCloseOnTarget:!0,placement:"bottom",toggler:Object(l.b)("div",{css:{height:"28px",transform:"translateX(18px)"}}),children:Object(l.c)("div",{css:{width:"140px",height:"143px",position:"relative"},children:[Object(l.b)("img",{src:t,alt:n,css:{width:"100px",height:"100px",padding:"20px"}}),Object(l.b)("div",{onClick:i,css:{position:"absolute",width:"16px",height:"16px",right:"8px",top:"8px",".Zi--Close":{width:"16px",height:"16px"}},children:Object(l.b)(te.a,{})})]})})},Se=n(1414),Pe=n(1261),Ee=["onInsertEmoji","onAddSticker","vipEnabled"],Te=Object(m.forwardRef)((function(e,t){var n=e.onInsertEmoji,a=void 0===n?Z.a:n,r=e.onAddSticker,c=void 0===r?Z.a:r,i=e.vipEnabled,s=void 0!==i&&i,m=Object(o.default)(e,Ee),u=Object(oe.c)((function(e,t){"emoji"===t?a(e.placeholder):c(e)}));return Object(l.b)(Q.a,Object.assign(Object.assign({arrowed:!0,preventCloseOnTarget:!0},m),{},{ref:t,children:Object(l.b)(Pe.a,{onSelectEmoticon:u,css:{border:"none"},vipEnabled:s})}))}));var Be,Le=Object(ce.a)((function(e){var t=e.disabled,n=e.onInsertEmoji,o=void 0===n?Z.a:n,a=e.onAddSticker,r=void 0===a?Z.a:a,c=e.popoversController,i=Object(m.useRef)();Object(m.useEffect)((function(){c.register(pe,i.current)}),[c]);var s=Object(oe.c)((function(){o.apply(void 0,arguments),setTimeout(c.position,400)})),u=Object(oe.c)((function(){c.openSelected(),r.apply(void 0,arguments),setTimeout(c.position,400)})),d=Object(oe.c)((function(t){(0,e.authRequired)([Z.a,function(){t.preventDefault()}])()}));return Object(l.b)(Te,{ref:i,onInsertEmoji:s,onAddSticker:u,vipEnabled:!0,onClick:d,toggler:Object(l.b)($.a,{label:"插入表情",icon:Se.a,disabled:t,onMouseEnter:c.prepare})})}));function xe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}function ze(e){var t=e.dynamicImageUrl||e.staticImageUrl,n=e.id,o=e.title||"[sticker]";return'<a class="comment_sticker" href="'.concat(t,'" data-sticker-id="').concat(n,'">').concat(o,"</a>")}function De(e){var t=e.url,n=e.dataRawwidth,o=e.dataRawheight,a=e.title,r=t.includes(".gif")?"comment_gif":"comment_img";return'<a class="'.concat(r,"\" href='").concat(t,"' data-width='").concat(n||"","' data-height='").concat(o||"","'>[").concat(a||"图片","]</a>")}var Me=function(e){Object(c.a)(n,e);var t=xe(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,r=new Array(o),c=0;c<o;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).zaRef=Object(m.createRef)(),e.state={active:!1,hasNoContent:!0,shown:!1,submitting:!1,value:{toHTML:le},images:[],uploadIsFetchingNum:0,stickers:[],toggleInputStyle:!1,commentTextLength:0,showCommentCheckModal:!1},e.isClubPostPage=function(){var t=e.props,n=t.type,o=(t.replyTo||{}).resourceType;return"club_post"===n||"club_post"===o},e.handleCheckClosed=function(){e.setState({showCommentCheckModal:!1}),e.trackCommentCheckClick("返回修改"),e.input.focus()},e.handleCommentCheck=function(){e.setState({showCommentCheckModal:!1}),e.handleSubmit(!1),e.trackCommentCheckClick("继续发布")},e.handleButtonSubmit=function(){e.handleSubmit(!0,"0"!==e.props.autoCheckAb)},e.handleSubmit=e.context.authRequired((function(t,n){return e.context.realNameRequired((function(){var o=e.props,a=o.replyTo,r=o.onSubmit,c=o.onCancel,i=o.rootCommentId,s=o.isConversation,l=o.zaInfo.zaSubmitCommentId;if(!e.state.submitting){e.setState({submitting:!0});var m=e.state,u=m.images,d=m.stickers,p=e.input.toHTML();if(p||u.length||d.length){var h;p&&e.saveLocalComment();var b=p;u.length&&(b+=De(u[0])),d.length&&(b+=ze(d[0]));var f,v=r(b,a,{rootCommentId:i,isConversation:s},t,n);if(v.then)v.then((function(){var t;(c&&c(),e.input)?(e.input.reset(),null===(t=e.popoverControllerRef.current)||void 0===t||t.closeAll(),e.resetImage(),e.setState({value:{toHTML:le}},(function(){return e.saveLocalComment()}))):e.saveLocalComment({toHTML:le})})).catch((function(t){40313===t.payload.code&&e.setState({showCommentCheckModal:!0})})).finally((function(){e.setState({submitting:!1})}));else e.setState({submitting:!1}),c&&c(),e.input.reset(),null===(f=e.popoverControllerRef.current)||void 0===f||f.closeAll();A.a.trackEvent(Object(D.a)(e),Object.assign({action:"Comment",element:"Button"},l&&{id:l})),null===(h=e.zaRef.current)||void 0===h||h.trackEvent({eventType:"Click",action:"Comment",elementLocation:{type:"Button"}})}}}))()}),e.isClubPostPage()?ie.L.reply_club:void 0,I.b),e.handleCommentShow=e.context.authRequired((function(){e.setState({shown:!0}),e.hiddenInput.focus()})),e.handleCommentHide=function(){e.setState({shown:!1})},e.initLocalComment=function(){var t=e.props,n=t.type,o=t.id;if(n&&o){var a=U.a.get(se)||[],r="".concat(n,"_").concat(o),c=a.find((function(e){return e.key===r})),i=c&&c.value;i&&e.setState({value:{toHTML:function(){return i}},hasNoContent:!1})}},e.saveLocalComment=function(t){var n=e.props,o=n.type,a=n.id;if(o&&a){var r=t?t.toHTML():e.state.value.toHTML(),c="".concat(o,"_").concat(a),i=(U.a.get(se)||[]).filter((function(e){return e.key!==c})),s=r?[].concat(Object(z.a)(i.slice(0,4)),[{key:c,value:r}]):i;U.a.set(se,s)}},e.handleChange=function(t){var n=e.state,o=n.stickers,a=n.images;o.length||a.length?e.setState({value:t}):e.setState({value:t,hasNoContent:t.isEmpty}),e.handleInputChange()},e.handleFocus=function(){e.setState({active:!0},e.handleInputChange)},e.handleBlur=function(){var t=e.state,n=t.stickers,o=t.images;n.length||o.length||(e.setState({active:!1}),e.handleInputChange())},e.handleMobileComment=function(){e.handleSubmit(),e.handleCommentHide()},e.handleInputChange=function(){var t,n,o=Object(M.findDOMNode)(e.input);o&&(o.getBoundingClientRect().height>40?e.setState({toggleInputStyle:!0}):e.setState({toggleInputStyle:!1}),n="innerText"in document?o.innerText.length:o.textContent.length,e.setState({commentTextLength:n}),null===(t=e.popoverControllerRef.current)||void 0===t||t.position())},e.handleImages=function(t){var n;e.setState({images:t},null===(n=e.popoverControllerRef.current)||void 0===n?void 0:n.position)},e.handleInputActive=function(t){e.setState({active:t})},e.updatePublishStatus=function(t){e.setState({hasNoContent:t})},e.resetStickers=function(){var t=e.state.value,n=void 0===t.isEmpty||t.isEmpty;e.setState({stickers:[],hasNoContent:n})},e.resetImage=function(){e.resetStickers(),e.resetUploadImg()},e.resetUploadImg=function(){var t=e.state.value,n=void 0===t.isEmpty||t.isEmpty;e.setState({images:[],hasNoContent:n})},e.insertEmoji=function(t){var n;null===(n=e.input)||void 0===n||n.handleCommand("insert-text:".concat(t))},e.addSticker=function(t){e.setState({stickers:[t],images:[],hasNoContent:!1})},e.handleImagePopoverOpen=function(){e.setState({stickers:[]})},e.focusInput=function(t){t.preventDefault(),e.input.focus()},e.popoverControllerRef=Object(m.createRef)(),e.renderInput=function(t){var n,o,a,r=t.placeholder,c=t.className,i=e.props,s=i.autoFocus,m=i.commentWithPicPermission.commentWithPic,u=e.state,d=u.images,p=u.stickers,h=u.toggleInputStyle,b=u.active,f=u.hasNoContent,v=u.commentTextLength;return Object(l.c)("div",{className:C()("CommentEditorV2-inputWrap",{"CommentEditorV2-inputWrap--change":h,"CommentEditorV2-inputWrap--active":b||!f}),onClick:function(e){e.nativeEvent.stopImmediatePropagation()},children:[Object(l.b)(W.b,{keyMap:{FOCUS_COMMENT_INPUT:"shift+c"},handlers:{FOCUS_COMMENT_INPUT:e.focusInput}}),Object(l.b)(Y.a,{className:C()("CommentEditorV2-input",c),defaultValue:e.state.value.toHTML(),allowMention:!0,allowPasteRichText:!1,autoFocus:s,outputBlockType:"div",ref:function(t){e.input=t},placeholder:r,onFocus:e.handleFocus,onChange:e.handleChange,onSubmit:e.handleButtonSubmit,minRows:5}),Object(l.c)("div",{className:C()("CommentEditorV2-inputUpload",{"CommentEditorV2-inputUpload--FlexEnd":h,"CommentEditorV2-inputUpload--SpaceBetween":h&&v>980}),children:[h&&v>980&&Object(l.b)(G.a,{className:"CommentEditorV2-MaxLength",current:v,max:1e3}),Object(l.b)("div",{className:"CommentEditorV2-popoverWrap",children:Object(l.c)(fe,{ref:e.popoverControllerRef,children:[Object(l.b)(ke,{images:d,resetUploadImg:e.resetUploadImg,handleInputActive:e.handleInputActive,updatePublishStatus:e.updatePublishStatus,handleImages:e.handleImages,onPopoverOpen:e.handleImagePopoverOpen,hasPermission:m||e.isClubPostPage()}),Object(l.b)(we,{url:(null===(n=p[0])||void 0===n?void 0:n.dynamicImageUrl)||(null===(o=p[0])||void 0===o?void 0:o.staticImageUrl),title:null===(a=p[0])||void 0===a?void 0:a.title,onReset:e.resetStickers}),Object(l.b)(Le,{onAddSticker:e.addSticker,onInsertEmoji:e.insertEmoji,preparePopoverIndex:e.preparePopoverIndex})]})})]})]})},e}return Object(r.a)(n,[{key:"trackCommentCheckClick",value:function(e){A.a.trackEvent(null,{id:7497,action:"Click",path:[{module_name:"图文弹窗"}]},{button:{text:e}})}},{key:"componentDidMount",value:function(){this.initLocalComment(),document.addEventListener("click",this.handleBlur)}},{key:"componentWillUnmount",value:function(){this.saveLocalComment(),document.removeEventListener("click",this.handleBlur)}},{key:"render",value:function(){var e=this.props,t=e.replyTo,n=e.commentNeedsReview,o=e.className,a=e.ownerAuthorIsOrg,r=e.ownerAuthorIsBrand,c=e.commentStatus,i=this.state,s=i.active,m=i.hasNoContent,u=i.submitting,d=i.showCommentCheckModal,p=a?"机构":"作者",h={preset:"primary",color:"blue",children:"发布",disabled:m||u},b="写下你的评论...";if(n&&(b=r?"已开启预审评论，评论由品牌筛选后公开":a?"已开启预审评论，评论由机构筛选后公开":"评论由作者筛选后显示"),t&&t.author){var f=t.author,v=f.member,O=f.mask,j=(null==v?void 0:v.name)||(null==O?void 0:O.name)||t.author.name;b=_()(Be||(Be=Object(x.a)(["回复","",""])),j,n?"，评论由".concat(p,"筛选后公开"):"")}return c&&!1===c.canComment&&(b=c.toast),Object(l.c)("div",{children:[Object(l.b)(V.d,{ref:this.zaRef}),Object(l.c)("div",{className:C()(o,"CommentEditorV2--normal",{"CommentEditorV2--active":s||!m}),children:[this.renderInput({placeholder:b}),Object(l.b)(H.c,Object.assign(Object.assign({},h),{},{className:"CommentEditorV2-singleButton",onClick:this.handleButtonSubmit}))]}),d&&Object(l.b)(Ne,{onClose:this.handleCheckClosed,onSubmit:this.handleCommentCheck})]})}}]),n}(m.Component);Me.propTypes={className:p.a.string,defaultActive:p.a.bool,replyTo:p.a.object,inCommentItem:p.a.bool,commentNeedsReview:p.a.bool,canComment:p.a.object,onCancel:p.a.func,onSubmit:p.a.func.isRequired,zaInfo:p.a.object},Me.defaultProps={defaultActive:!1,replyTo:null,inCommentItem:!1,autoFocus:!0,ownerAuthorIsOrg:!1,ownerAuthorIsBrand:!1,zaInfo:{}},Me.contextTypes={authRequired:p.a.func,realNameRequired:p.a.func};var Ae=Object(f.compose)(h.withRouter,Object(K.a)(),Object(b.connect)((function(e){return{stickers:e.commentsV2.stickers||[],commentWithPicPermission:e.commentsV2.commentWithPicPermission||{}}}),{showNotification:I.g}))(Me),Ve=n(1316),Fe=n(1239),_e=n(1317),qe=n(85),Ue=n(1107),He=n(1192),Ge=n(1159),We=n(1536),Ke=n(1152),Ye=n(1195),Je=n(1444),Xe=n(1326),Ze=n(28),Qe=function(e){return u.a.createElement(Ze.a,e,u.a.createElement("path",{d:"M11.31.813c2.475.403 3.584 2.211 2.827 5.746l-.062.275-.043.173h3.689c2.17 0 3.694 1.704 3.487 3.798l-.024.197-.034.194-.145.732-.025.102-1.823 6.32c-.4 1.384-1.741 2.601-3.085 2.841l-.184.027-.126.007-.166-.001-8.152-.638-.15-.018-.149-.03-.014-.004H3.385a2.612 2.612 0 0 1-2.591-2.277l-.016-.169-.005-.165V9.615A2.612 2.612 0 0 1 3.219 7.01l.166-.006h2.904l.103-.123.476-.59c1.413-1.77 1.883-2.496 2.082-3.3l.025-.11.04-.207c.025-.153.034-.269.037-.365a1.638 1.638 0 0 1 1.52-1.524c.215-.021.463-.016.738.029zm-.324 1.936l-.012.097-.049.3c-.221 1.193-.677 2.016-2.09 3.824l-.2.253-.613.767-.21.255-.187.21V18.63l8.078.632h.032c.463-.052 1.126-.584 1.425-1.178l.062-.138.048-.14 1.809-6.259.145-.732c.2-1.007-.38-1.77-1.36-1.838l-.143-.005h-4.988a.97.97 0 0 1-.935-1.304l.022-.067.015-.046.217-.718c.817-2.888.38-3.802-.943-4.065l-.123-.022zM5.75 18.57V8.966l-2.365.001a.648.648 0 0 0-.642.553l-.007.095v8.308c0 .325.24.595.553.641l.096.007H5.75z"}))};Qe.defaultProps={name:"LikeOutline"};var $e=Qe,et=function(e){return u.a.createElement(Ze.a,e,u.a.createElement("path",{d:"M11.93 2C6.447 2 2 6.446 2 11.93 2 17.438 6.467 22 11.93 22c.986 0 2.163-.252 3.548-.745a2.6 2.6 0 0 1 1.556-.059l2.454.67a1.936 1.936 0 0 0 2.377-2.378l-.669-2.453a2.6 2.6 0 0 1 .06-1.557c.492-1.385.744-2.562.744-3.547C22 6.467 17.437 2 11.93 2zm0 2C16.343 4 20 7.581 20 11.93c0 .725-.206 1.69-.63 2.878l-.085.268a4.6 4.6 0 0 0-.018 2.485l.638 2.344-2.344-.638a4.6 4.6 0 0 0-2.753.104c-1.188.423-2.153.629-2.877.629C7.58 20 4 16.342 4 11.93A7.93 7.93 0 0 1 11.93 4z"}))};et.defaultProps={name:"SpeechBalloonOutline"};var tt=et,nt=n(111),ot=n(148),at=n(597),rt=n(167),ct=n(336),it=n(416),st=n(421),lt=n(233),mt=n(275),ut=n(59),dt=n(232),pt=["html","className","prefix"];function ht(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var bt=function(e){Object(c.a)(n,e);var t=ht(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,r=new Array(o),c=0;c<o;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={previewImg:null},e.handlePreview=function(t){var n=t.target,o=e.props.onPreviewImage;"function"==typeof o?o(t).catch((function(){e.setState({previewImg:n})})):e.setState({previewImg:n})},e}return Object(r.a)(n,[{key:"mount",value:function(){var e=this;this.imagesGifNode=this.root.getElementsByClassName("comment_gif"),this.imagesNode=this.root.getElementsByClassName("comment_img"),this.imagesStickerNode=this.root.getElementsByClassName("comment_sticker"),this.imgNode=this.root.getElementsByClassName("origin_image zh-lightbox-thumb"),this.imagesNodes=Array.from([].concat(Object(z.a)(this.imagesGifNode),Object(z.a)(this.imagesNode),Object(z.a)(this.imagesStickerNode),Object(z.a)(this.imgNode))).map((function(t){var n=t.dataset||{},o=n.width,a=n.height,r=n.rawwidth,c=n.rawheight,i=Number(o||r),s=Number(a||c),l=document.createElement("div");l.className="Richtext-content_img",t.parentNode.replaceChild(l,t);var m=t.getAttribute("href")||t.getAttribute("src"),u=new Image,d=t.getAttribute("class");return"comment_sticker"!==d&&l.addEventListener("click",e.handlePreview),u.className=d,u.src=m,u.dataset.original=Object(ut.imgUrl)(m,"r"),u.dataset.rawwidth=i,u.onload=function(){i===s||"comment_sticker"===d?l.classList.add("Richtext-content_img-square"):i>s?l.classList.add("Richtext-content_img-square--wideShape"):l.classList.add("Richtext-content_img-square--highShape"),l.appendChild(u)},l}))}},{key:"unmount",value:function(){this.imagesNodes&&this.imagesNodes.forEach((function(e){Object(M.unmountComponentAtNode)(e)}))}},{key:"componentDidMount",value:function(){this.mount()}},{key:"componentWillUpdate",value:function(e){this.props.html!==e.html&&this.unmount()}},{key:"componentDidUpdate",value:function(e){e.html!==this.props.html&&this.mount()}},{key:"componentWillUnmount",value:function(){this.unmount()}},{key:"render",value:function(){var e=this,t=this.state.previewImg,n=this.props,a=n.html,r=n.className,c=n.prefix,i=Object(o.default)(n,pt);return Object(l.c)("div",{className:C()("CommentRichText",r),ref:function(t){return e.root=t},children:[c,Object(l.b)(dt.a,Object.assign({html:a},i)),t&&Object(l.b)(mt.a,{className:"CommentRichText-ImageView",img:t,onClose:function(){return e.setState({previewImg:null})}})]})}}]),n}(m.Component);function ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var vt=function(e){Object(c.a)(n,e);var t=ft(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,r=new Array(o),c=0;c<o;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).zaRef=Object(m.createRef)(),e.state={isReplying:!1,deleteModal:!1},e.toggleReply=e.context.authRequired((function(){var t=e.props,n=t.commentStatus,o=t.showNotification;n&&!1===n.canReply?o(n.toast,"red",I.b):e.setState({isReplying:!e.state.isReplying})}),"club_post"===e.props.type?ie.L.reply_club:void 0,I.b),e.like=e.context.authRequired((function(t){var n=e.props;(0,n.onLike)(n.comment.id,t),e.zaRef.current.trackEvent({action:"Upvote",eventType:"Click",elementLocation:{type:"Button"}})}),ie.L.like,I.b),e.dislike=e.context.authRequired((function(){var t=e.props;(0,t.onDislike)(t.comment.id),e.zaRef.current.trackEvent({action:"UnUpvote",eventType:"Click",elementLocation:{type:"Button"}})}),ie.L.like,I.b),e.delete=function(){var t=e.props;return(0,t.onDelete)(t.comment.id)},e.feature=function(t){var n=e.props,o=n.onFeature,a=n.comment.id;o(t?"".concat(a,"_featured"):a)},e.collapse=function(){var t=e.props;(0,t.onCollapse)(t.comment.id)},e.approve=function(){var t=e.props;(0,t.onApprove)(t.comment.id)},e.reject=function(){var t=e.props;(0,t.onReject)(t.comment.id)},e.showConversation=function(t){var n=e.props;(0,n.onShowConversation)({commentId:n.comment.id,isAnchorComments:t})},e.stopReply=function(){e.setState({isReplying:!1})},e.closeReportModal=function(e){if(e){var t=e.result.payload,n=t&&t.message||t&&t.code&&"举报失败";e.commentDeleteResult&&!(e.commentDeleteResult.payload||{}).code?ct.b.showModal({reportText:n}):t&&t.sarcasmRecommend||Object(rt.b)(n||"举报成功")}},e.handleCloseDelete=function(){return e.setState({deleteModal:!1})},e.handleDelete=function(){return e.setState({deleteModal:!0})},e.handleClick=function(t,n){var o=e.props.parent,a=o.type,r=o.id;Object(nt.e)(Object(ot.a)({type:a,id:r},{utm_campaign:"routine",utm_medium:"internal",utm_source:"video",utm_content:n})),t.stopPropagation(),t.preventDefault()},e}return Object(r.a)(n,[{key:"renderRoleInfo",value:function(e,t){return"normal"===e?null:Object(l.b)("span",{className:"CommentItemV2-roleInfo",children:"ancestor"===e||"author"===e&&"question"===t?" (提问者) ":" (作者) "})}},{key:"renderReplyTo",value:function(){var e=this.props.comment,t=e.replyToAuthor,n=e.resourceType;if(!t)return null;var o=t.member,a=t.role,r=t.mask;return Object(l.c)(m.Fragment,{children:[Object(l.b)("span",{className:"CommentItemV2-reply",children:"回复"}),Object(l.b)(it.a,{noBadge:!0,noHoverCard:!0,user:o||r||{}}),this.renderRoleInfo(a,n)]})}},{key:"renderItem",value:function(){var e,t=this,n=this.props,o=n.isConversation,a=n.ownerAuthorIsOrg,r=n.parent,c=r.canComment,i=(c=void 0===c?{status:!0}:c).status,s=r.questionType,u=n.parent,d=n.commentNeedsReview,p=n.comment,h=n.onReply,b=n.status,f=n.type,v=n.canOperate,O=n.commentPattern,j=n.rootCommentId,g=n.byComment,y=n.isReverseAndStatusOpen,R=n.hasRecommend,k=n.permission.canBrandAdminEdit,I=n.showCollapsed,N=n.isMobile,w=this.state.isReplying,S=p.id,P=p.author,E=p.richText,T=p.content,B=p.voteCount,L=p.replyToAuthor,x=p.isAuthor,z=p.createdTime,D=p.featured,M=p.voting,A=p.reviewing,V=p.disliked,F=p.resourceType,_=p.childCommentCount,q=p.allowDelete,U=p.allowVote,G=p.canRecommend,W=p.canCollapse,K=p.collapsedReason,Y=void 0===K?"":K,J=p.isDelete,X=p.collapsed,Z=p.top,Q=X&&!I,$=Q?"该评论已被折叠":J?function(e){var t=e.content,n=e.deleteReason;if(n){var o=JSON.stringify({button:{text:String(n.reasonId)}}).replace(/"/g,"&quot;");return'<a href="'.concat(n.url,'" target="_blank" data-za-detail-view-id="7641" data-za-extra="').concat(o,'">').concat(n.tip,"</a>")}return t}(p):E||T,ee=J||Q,te=P||{},ne=te.role,oe=te.mask,ae=(null==P?void 0:P.member)||oe,re=Boolean(L),ce=D&&(_>0||re)&&!o||g&&re||y&&re,ie=x||q&&("question"!==f||"commercial"===s),se=Object(l.c)("div",{className:"CommentItemV2-footer",children:[Object(l.c)(H.c,{className:C()("CommentItemV2-likeBtn",M&&"is-liked"),preset:"plain",onClick:this.like,disabled:x||!i,children:[Object(l.b)(Ue.a,{style:{marginRight:5},center:!0,size:16}),B>0?B:"赞"]}),X&&Y&&Object(l.c)("div",{className:"CommentItemV2-walleTag",children:["阴阳怪气自动折叠"===Y&&Object(l.b)(He.a,{size:16,className:"CommentItemV2-walleIcon"}),Y]}),ce&&Object(l.c)(H.c,{preset:"plain",className:"CommentItemV2-talkBtn",onClick:function(){return t.showConversation(re)},children:[Object(l.b)(Ge.a,{style:{marginRight:5},center:!0,size:16}),"查看回复"]}),!x&&i&&!X&&Object(l.c)(H.c,{preset:"plain",className:C()({"CommentItemV2-hoverBtn":!w}),onClick:this.toggleReply,children:[Object(l.b)(We.a,{style:{marginRight:5},center:!0,size:16}),w?"取消回复":"回复"]}),G&&!R&&v&&Object(l.c)(H.c,{className:C()({"CommentItemV2-hoverBtn":!x&&!w}),preset:"plain",onClick:function(){return t.feature(D)},children:[Object(l.b)(Ke.a,{style:{marginRight:5},center:!0,size:16}),D?"取消推荐":"推荐"]}),W&&!x&&Object(l.c)(H.c,{className:C()({"CommentItemV2-hoverBtn":!x&&!w}),preset:"plain",onClick:this.collapse,children:[Object(l.b)(Ye.a,{style:{marginRight:5},center:!0,size:14}),X?"取消折叠":"折叠"]}),U&&!x&&v&&Object(l.c)(H.c,{className:C()({"CommentItemV2-hoverBtn":!w}),preset:"plain",onClick:this.dislike,disabled:!i,children:[Object(l.b)(Ue.a,{style:{transform:"rotate(180deg)",marginRight:5},size:16,center:!0}),V?"取消踩":"踩"]}),x||Object(l.c)(m.Fragment,{children:[Object(l.b)(lt.a,{id:S,type:"comment",className:"CommentItemV2-hoverBtn",onModalShown:function(e,n){e||t.closeReportModal(n)},modalProps:Object.assign(Object.assign({},ie&&{onDeleteComment:this.delete}),{},{notification:{failure:at.a}})}),"question"===f&&"commercial"===s&&k&&Object(l.c)(H.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.reject,children:[Object(l.b)(Ye.a,{style:{marginRight:5},center:!0,size:16}),"隐藏"]})]}),ie&&Object(l.c)(H.c,{className:C()({"CommentItemV2-hoverBtn":!x&&!w&&!w}),preset:"plain",onClick:this.handleDelete,children:[Object(l.b)(Je.a,{style:{marginRight:5},center:!0,size:16}),"删除"]}),Object(l.b)(ct.a,{shown:this.state.deleteModal,id:S,onDelete:this.delete,onClose:this.handleCloseDelete})]});return e=w?Object(l.c)("div",{children:[se,Object(l.b)(Ae,{type:"comment",id:S,commentNeedsReview:d,className:"CommentItemV2-editor",defaultActive:!0,replyTo:p,onCancel:this.stopReply,onSubmit:h,rootCommentId:j,isConversation:o})]}):"reviewing"===b?Object(l.c)("div",{className:"CommentItemV2-footer",children:[Object(l.c)(H.c,{preset:"plain",onClick:this.approve,children:[Object(l.b)(Xe.a,{style:{marginRight:5},center:!0,size:14}),"公开"]}),Object(l.c)(H.c,{className:"CommentItemV2-hoverBtn",preset:"plain",onClick:this.handleDelete,children:[Object(l.b)(Je.a,{style:{marginRight:5},center:!0,size:16}),"删除"]}),Object(l.b)(ct.a,{shown:this.state.deleteModal,id:S,onDelete:this.delete,onClose:this.handleCloseDelete})]}):se,Object(l.c)("div",{children:[Object(l.c)("div",{className:"CommentItemV2-meta",children:[ae&&Object(l.b)(st.a,{className:"CommentItemV2-avatar",noHoverCard:"fixed"===O||"club_post"===f,user:ae}),ae&&Object(l.b)(it.a,{noBadge:!0,noHoverCard:!0,user:ae}),this.renderRoleInfo(ne,F),this.renderReplyTo(),Z&&Object(l.b)("span",{className:"CommentItemV2-officialTop",children:"官方置顶"}),A&&Object(l.b)(Ye.a,{className:"CommentItemV2-reviewing","data-tooltip":"".concat(!1===a?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开"),"aria-label":"".concat(!1===a?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开"),center:!0,size:14}),Object(l.b)("span",{className:"CommentItemV2-time",children:Object(qe.toSmartString)(z)})]}),Object(l.c)("div",{className:"CommentItemV2-metaSibling",children:[Object(l.b)(bt,{className:C()("CommentItemV2-content",{"CommentItemV2-shield":ee}),html:$}),"zvideo"===u.type&&N&&Object(l.c)("div",{className:"CommentItemV2-zvideoFooter",children:[Object(l.c)("div",{role:"button",tabIndex:0,onClick:function(e){return t.handleClick(e,"agree")},children:[B>0&&B,M?Object(l.b)(Ue.a,{style:{marginRight:20,marginLeft:5},center:!0,size:14}):Object(l.b)($e,{style:{marginRight:20,marginLeft:5},center:!0,size:14})]}),Object(l.b)("div",{role:"button",tabIndex:0,"aria-label":"回复",onClick:function(e){return t.handleClick(e,"reply")},children:Object(l.b)(tt,{center:!0,size:14})})]}),!ee&&e]})]})}},{key:"render",value:function(){var e=this.props,t=e.comment,n=e.onRef;return Object(l.c)(V.b,{content:{type:"Comment",id:String(t.id)},children:[Object(l.b)(V.d,{ref:this.zaRef}),Object(l.b)("div",{className:"CommentItemV2",ref:n,children:this.renderItem()})]})}}]),n}(m.Component);vt.propTypes={comment:p.a.object.isRequired,parent:p.a.object.isRequired,commentNeedsReview:p.a.bool,type:p.a.string,isConversation:p.a.bool,onLike:p.a.func.isRequired,onShowConversation:p.a.func,onReply:p.a.func,onFeature:p.a.func,onDelete:p.a.func.isRequired,onCollapse:p.a.func,commentPattern:p.a.string,showCollapsed:p.a.bool},vt.contextTypes={currentUser:p.a.object,authRequired:p.a.func};var Ct=Object(f.compose)(h.withRouter,Object(b.connect)((function(e){return{isWechat:e.env.userAgent.Wechat,permission:Object(P.l)(e),isMobile:e.env.userAgent.Mobile}}),{showNotification:I.g}))(vt),Ot=n(4);function jt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var gt=function(e){Object(c.a)(n,e);var t=jt(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,r=new Array(o),c=0;c<o;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={},e.handleClick=function(){var t=e.props,n=t.loadRestComments,o=t.onShowConversation,a=t.comment,r=a.id,c=a.childCommentCount,i=c<=5&&c>2;(i?n:o)({commentId:r}),i&&e.setState(Object(Ot.a)({},"hide_".concat(r),!0))},e.handleRef=function(t){var n=e.props.onRef;"function"==typeof n&&n(t)},e}return Object(r.a)(n,[{key:"render",value:function(){var e=this.props,t=e.comment,n=t.id,o=t.childCommentCount,a=e.isFetching,r=e.className,c=this.state["hide_".concat(n)],i=o<=5&&o>2?"展开其他 ".concat(o-2," 条回复"):"查看全部 ".concat(o," 条回复");return Object(l.c)("div",{className:r,ref:this.handleRef,children:[!c&&Object(l.b)("div",{className:"CommentMoreReplyButton",children:Object(l.b)(H.c,{preset:"plain",onClick:this.handleClick,children:i})}),a&&Object(l.b)(y.a,{className:"CommentMoreReplyButton",small:!0})]})}}]),n}(m.Component);function yt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}gt.propTypes={comment:p.a.object.isRequired,isFetching:p.a.bool,onShowConversation:p.a.func,loadRestComments:p.a.func};var Rt=function(e){Object(c.a)(n,e);var t=yt(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,r=new Array(o),c=0;c<o;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).loadRestComments=function(t){var n=t.commentId;(0,e.props.loadConversation)({id:n,isLoadRest:!0})},e}return Object(r.a)(n,[{key:"render",value:function(){var e=this.props,t=e.parent,n=t.type,o=t.author,a=(o=void 0===o?{isOrg:!1}:o).isOrg,r=e.parent,c=e.commentNeedsReview,i=e.onShowConversation,s=e.status,u=e.onItemLike,d=e.onItemDelete,p=e.onItemCollapse,h=e.onItemDislike,b=e.onItemApprove,f=e.onItemReject,v=e.canOperateItem,O=e.commentPattern,j=e.commentStatus,g=e.conversation,y=void 0===g?{}:g,R=e.entities,k=e.byComment,I=e.isReverseAndStatusOpen,N=e.comment,w=e.onReply,S=e.onFeature,P=e.ids,E=e.showCollapsed,T=N.id,B=N.featured,x=N.childComments,z=void 0===x?[]:x,D=N.childCommentCount,M=void 0===D?0:D,A=B?"".concat(T,"_featured"):"".concat(T),V=!B&&P.includes("".concat(T,"_featured")),F=Boolean(z.length)&&!I,_=M<=5&&M>2,q=z.map((function(e){return R.comments[e]})).map(L),U=!B&&M>2&&!I,H=(_&&y[T]||{isFetching:!1}).isFetching;return Object(l.c)(m.Fragment,{children:[Object(l.b)("li",{className:C()({"NestComment--rootCommentNoChild":!F,"NestComment--rootComment":F}),children:Object(l.b)(Ct,{comment:N,status:s,type:n,parent:r,canOperate:v,commentNeedsReview:c,onShowConversation:i,ownerAuthorIsOrg:a,onLike:u,onReply:w,onFeature:S,onDelete:d,onCollapse:p,onDislike:h,onApprove:b,onReject:f,commentPattern:O,commentStatus:j,rootCommentId:T,byComment:k,isReverseAndStatusOpen:I,hasRecommend:V,showCollapsed:E},A)},A),F&&q.map((function(e){var t=e.id,o=e.featured,m=o?"".concat(t,"_featured"):"".concat(t),C=!o&&P.includes("".concat(t,"_featured"));return Object(l.b)("li",{className:"NestComment--child",children:Object(l.b)(Ct,{comment:e,status:s,type:n,parent:r,canOperate:v,commentNeedsReview:c,onShowConversation:i,ownerAuthorIsOrg:a,onLike:u,onReply:w,onFeature:S,onDelete:d,onCollapse:p,onDislike:h,onApprove:b,onReject:f,commentPattern:O,commentStatus:j,rootCommentId:T,hasRecommend:C,showCollapsed:E},m)},m)})),U&&Object(l.b)(gt,{comment:N,isFetching:H,onShowConversation:i,loadRestComments:this.loadRestComments})]})}}]),n}(m.Component),kt=Object(f.compose)(Object(b.connect)(null,{loadConversation:O.h}))(Rt);function It(e){var t=e.id,n=e.replyTo,o=e.isConversation;if(e.isNotification)return{type:"notification"};if(o)return{type:"conversation"};if(!n)return{type:"comment"};var a=n.featured,r=n.replyToAuthor,c=n.id;return t===c&&a?r?{type:"replyToSubFeatured"}:{type:"replyToFeatured"}:t!==c||r?t!==c&&r?{type:"replyToSubCommon"}:{type:"comment"}:{type:"replyToCommon"}}var Nt=n(1221);function wt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var St=function(e){Object(c.a)(n,e);var t=wt(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,r=new Array(o),c=0;c<o;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={collapsed:!0,current:1},e.commentsWithPaginationElRef=Object(m.createRef)(),e.load=function(t,n,o){if(!e.props.isFetching&&!e.props.parent.adminClosedComment){var a=t||e.props,r=a.order,c=a.status,i=a.parent,s=i.id,l=i.type,m=a.commentPattern,u=a.needLoadCommentPermission,d=a.loadComments,p=a.notificationId,h=a.loadNotificationComments;if(p)return h(p);u&&e.loadCommentPermission(l,s),d(l,s,{order:r,isPrevious:n,commentPattern:m,status:o?"collapsed":c},o)}},e.addComment=function(t,n,o,a,r){var c=o.rootCommentId,i=o.isConversation,s=e.props,l=s.parent,m=l.id,u=l.type,d=s.commentId,p=s.addComment,h=s.notificationId;return p({parentType:u,parentId:m,content:t,replyTo:n,conversationId:d,rootCommentId:c,isConversation:i,notificationId:h,replyType:It({id:c,replyTo:n,isConversation:i,isNotification:Boolean(h)}).type,useStrictMode:a,enableUnfriendlyCheck:r})},e.featureItem=function(t){(0,e.props.onItemFeature)(t,e.lastFeaturedIndex)},e.handleOpenCollapsed=function(){e.setState({collapsed:!1}),e.load(e.props,!1,!0)},e.handlePageSelect=function(t){var n=e.props.onPaginationClick,o=e.state.current;n&&n(o,t),e.commentsElement.scrollIntoView(),e.setState({current:t}),e.loadByPagination(t)},e.loadByPagination=function(t,n){var o=n||e.props,a=o.order,r=o.status,c=o.parent,i=c.id,s=c.type,l=o.commentPattern,m=o.needLoadCommentPermission,u=o.loadComments;m&&e.loadCommentPermission(s,i),u(s,i,{order:a,isPrevious:!1,status:r,commentPattern:l,current:t})},e.renderComment=function(t){var n=t.id,o=t.featured?"".concat(n,"_featured"):n,a=!e.state.collapsed;return Object(l.b)("ul",{className:"NestComment",children:Object(l.b)(kt,Object.assign({comment:t,commentStatus:e.props.parent.commentStatus,onReply:e.addComment,onFeature:e.featureItem,showCollapsed:a},e.props))},o)},e.renderNormalComments=function(t){var n=e.state.collapsed,o=e.props,a=o.byComment,r=o.lastFeaturedIndex,c=o.parent,i=c.featuredCounts,s=c.commonCounts,m=[],u=i>0;return e.lastFeaturedIndex=0,t.length>0&&t.forEach((function(o,c){if(a||!o.collapsed){var d=t[c-1];o.collapsed&&(d&&d.collapsed||m.push(e.renderCollapsedDivider()),n)||(c===r&&m.push(Object(l.b)("div",{className:"NestComment-nextSiblings--noBorder"},"NestComment-nextSiblings--noBorder")),u&&0===c&&-1!==r&&m.push(Object(l.c)("div",{className:"CommentListV2-header-divider",children:["精选评论（",i,"）"]},"divider-featured")),m.push(e.renderComment(o)),c===r&&(e.lastFeaturedIndex=c,m.push(Object(l.c)("div",{className:"CommentListV2-header-divider",children:["评论（",s,"）"]},"divider-comment"))))}})),m},e.renderCollapsedComments=function(){var t=e.props,n=t.collapsedComments,o=t.isDrained,a=t.parent,r=(a=void 0===a?{}:a).collapsedCounts;return!o||r<=0?[]:n.map((function(t){return e.renderComment(t)}))},e.renderComments=function(t){return t.map(e.renderComment)},e.renderCollapsedDivider=function(){var t=e.props,n=t.isDrained,o=t.parent.collapsedCounts;return!n||o<=0?[]:e.state.collapsed?Object(l.b)("div",{className:"CommentListV2-action",children:Object(l.c)("div",{className:"CommentListV2-expendCollapseButton",children:[Object(l.c)("span",{role:"button",tabIndex:0,onClick:e.handleOpenCollapsed,children:[Object(k.formatNumber)(o)," 条评论被折叠"]}),"（",Object(l.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer",children:"为什么？"}),"）"]})},"collapsed"):Object(l.c)("div",{className:"CommentListV2-divider",children:[Object(l.b)("div",{className:"CommentListV2-dividerLine"}),Object(l.c)("div",{className:"CommentListV2-dividerText",children:[Object(k.formatNumber)(o)," 条评论被折叠（",Object(l.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer",children:"为什么？"}),"）"]})]},"divider-collapsed")},e.renderCollapsedInfiLoader=function(){var t=e.state.collapsed;if(t)return[];var n=e.props.collapsedInfo,o=void 0===n?{}:n,a=o.isFetching,r=void 0!==a&&a,c=o.isPrevDrained,i=void 0!==c&&c,s=o.isDrained,m=void 0!==s&&s;return Object(l.b)(y.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:r,isPrevDrained:i,isDrained:m,onLoad:function(n){return e.load(e.props,n,!t)},placeholder:Object(l.b)(y.a,{className:"CommentItem",small:!0}),children:e.renderCollapsedComments()})},e.renderPatternContent=function(t){var n=e.props,o=n.isFetching,a=n.parent.adminClosedComment,r=n.byComment,c=n.status,i=n.order,s=n.totals,m=n.showPackupButton,u=n.handlePackupButton,d=Math.ceil(s/20),p=e.state.current;return a?null:o?Object(l.b)(Ve.a,{}):Object(l.c)("div",{ref:e.commentsWithPaginationElRef,children:[Object(l.b)("div",{className:"CommentListV2",children:"normal"===i&&"open"===c?e.renderNormalComments(t):e.renderComments(t)}),d>1&&Object(l.b)(R.a,{className:"CommentsV2-pagination",current:p,total:d,onSelect:e.handlePageSelect}),!r&&e.renderCollapsedDivider(),!r&&e.renderCollapsedInfiLoader(),m&&Object(l.b)(_e.a,{onClick:u,commentsElRef:e.commentsWithPaginationElRef})]})},e.renderModalContent=function(t){var n=e.props,o=n.collapsedInfo,a=n.parent.adminClosedComment,r=n.status,c=n.order,i=n.byComment,s=e.state.collapsed,m=s?e.props:o,u=m.isFetching,d=void 0!==u&&u,p=m.isDrained,h=void 0!==p&&p,b=m.isPrevDrained,f=void 0!==b&&b;return h&&t.length<=0||a?Object(l.b)("div",{className:"CommentsV2-empty",children:Object(l.c)(E.d,{children:[Object(l.b)(E.a,{}),Object(l.b)("div",{children:"还没有评论"})]})}):Object(l.c)(y.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:d,isPrevDrained:f,isDrained:h,onLoad:function(t){return e.load(e.props,t,!s)},placeholder:Object(l.b)(y.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e},children:["normal"===c&&"open"===r?e.renderNormalComments(t):e.renderComments(t),!i&&e.renderCollapsedDivider(),!i&&e.renderCollapsedComments()]})},e.renderCommentEdit=function(){var t=e.props,n=t.parent,o=n.canComment,a=(o=void 0===o?{status:!0}:o).status,r=o.reason,c=n.author,i=(c=void 0===c?{isOrg:!1}:c).isOrg,s=n.type,m=n.id,u=n.adminClosedComment,d=n.commentStatus,p=n.questionType,h=t.byComment,b=t.autoFocus,f=t.commentNeedsReview,v=t.zaInfo,O=t.showNotification,j=u?"当前内容暂时无法评论":r,g=b&&!h,y=d&&!1===d.canComment;return a&&!u?Object(l.c)("div",{className:"CommentsV2-footer-wrapper",children:[Object(l.b)(Ae,{className:"CommentsV2-footer",type:s,id:m,commentNeedsReview:f,commentStatus:d,onSubmit:e.addComment,autoFocus:g,ownerAuthorIsOrg:i,ownerAuthorIsBrand:"commercial"===p,zaInfo:v}),y&&Object(l.b)("div",Object.assign({},Object(Nt.a)((function(){O(d.toast,"red")}),{className:"CommentsV2-footer-disabled"})))]}):Object(l.b)("div",{className:C()("CommentsV2-disabledText"),children:Object(l.b)("div",{className:"CommentsV2-disabledReason",children:j})})},e}return Object(r.a)(n,[{key:"loadCommentPermission",value:function(e,t){var n=this.props,o=n.loadAnswerCommentPermission,a=n.loadArticleCommentPermission;switch(e){case"answer":return o(t);case"article":return a(t);default:return null}}},{key:"componentDidMount",value:function(){var e=this.props,t=e.commentPattern,n=e.parent.adminClosedComment,o=e.stickers,a=e.loadStickers,r=e.getCommentWithPicPermission,c=e.commentWithPicPermission,i=e.currentUser;n||"bottom"!==t||this.loadByPagination(this.state.current),!o.length&&a(),void 0===c.commentWithPic&&i&&r()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,a=t.targetComment,r=t.commentPattern;n===e.order&&o===e.status||("bottom"===r?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var c=e.targetComment;c!==a&&c&&this.setState({collapsed:c.collapsed})}},{key:"componentWillUnmount",value:function(){Object(I.d)(I.b)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.comments,a=t.commentPattern,r=t.commentInputPosition,c=t.isAuthor,i=t.parent,s=i.author,m=(s=void 0===s?{isOrg:!1}:s).isOrg,u=i.commentPermission,d=i.reviewingCounts,p=i.commentCount,h=i.adminClosedComment,b=t.totals,f=t.status,v=t.order,O=t.onStatusChange,j=t.onOrderChange,g=t.targetLink,y=t.shouldReverse,R=t.permission.canBrandAdminEdit,k="censor"===u&&(c||R),I=k?{isCommentReviewer:k,onStatusChange:O,status:f,reviewingCounts:d}:{status:f};return Object(l.c)("div",{className:C()("CommentsV2 CommentsV2--withEditor",{"CommentsV2-withPagination":"bottom"===a},n),ref:function(t){e.commentsElement=t},children:[Object(l.b)(Fe.a,Object.assign({commentCount:void 0!==p?p:b,shouldReverse:y,commentClosed:h,targetLink:g,order:v,onOrderChange:j,commentPattern:a,isOrg:m},I)),"top"===r&&this.renderCommentEdit(),"bottom"===a?this.renderPatternContent(o):this.renderModalContent(o),"bottom"===r&&this.renderCommentEdit()]})}}]),n}(m.Component);St.propTypes={type:p.a.string,parent:p.a.object.isRequired,targetLink:p.a.node,commentNeedsReview:p.a.bool,byComment:p.a.oneOfType([p.a.number,p.a.string]),commentPattern:p.a.string,commentInputPosition:p.a.oneOf(["top","bottom"]),showPackupButton:p.a.bool,handlePackupButton:p.a.func,onPaginationClick:p.a.func,autoFocus:p.a.bool,shouldReverse:p.a.bool},St.contextTypes={authRequired:p.a.func.isRequired},St.defaultProps={commentInputPosition:"bottom",showPackupButton:!0,autoFocus:!0,shouldReverse:!0};var Pt=Object(f.compose)(Object(b.connect)((function(e,t){var n=t.parent,o=t.parent,a=o.type,r=o.id,c=t.status,i=t.order,s=t.byComment,l=t.commentPattern,m=t.notificationId,u=e.entities,d=e.commentsV2,p=d.conversation,h=d.stickers,b=void 0===h?[]:h,f=d.commentWithPicPermission,v=d.notificationsComments,C=d.parent,O=u.comments[s],j=d.pagination;"reviewing"===c&&(j=d.reviewing);var y="reverse"===i&&"open"===c;y&&(j=d.reverse);var R="".concat(a,"_").concat(r),k=[],I=d.collapsed[R]||{};I.ids&&I.ids.length>0&&(k=I.ids.map((function(e){return u.comments[e]}))),m&&(j=v,R=m);var N=j[R]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},w=N.isFetching,E=N.isPrevDrained,T=N.isDrained,B=N.ids,x=N.newIds,z=void 0===x?[]:x,D=N.totals,M="bottom"!==l?B:z,A=M.map((function(e){return u.comments[e]})).map(L),V=g()(M,(function(e){return String(e).includes("_featured")}));return{currentUser:Object(S.b)(e),isFetching:w,isPrevDrained:E,isDrained:T,totals:m?A.length:D,collapsedInfo:I,collapsedComments:k,targetComment:O,conversation:p,entities:u,stickers:b,lastFeaturedIndex:V,comments:A,isReverseAndStatusOpen:y,commentWithPicPermission:f,ids:M,parent:Object.assign(Object.assign({},n),C[R]),permission:Object(P.l)(e)}}),{loadComments:O.g,loadConversation:O.h,addComment:O.a,loadStickers:O.k,showNotification:I.g,clearNotification:I.d,getCommentWithPicPermission:O.f,loadNotificationComments:O.j,loadAnswerCommentPermission:N.k,loadArticleCommentPermission:w.c}),Object(T.a)())(St),Et=n(153),Tt=n.n(Et),Bt=n(206),Lt=n.n(Bt),xt=n(586);function zt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var Dt=function(e){Object(c.a)(n,e);var t=zt(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,r=new Array(o),c=0;c<o;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).load=function(){var t=e.props,n=t.isAnchorComments,o=t.conversationId;(0,t.loadConversation)({id:o,isAnchorComments:n})},e.addComment=function(t,n,o){var a=o.rootCommentId,r=o.isConversation,c=e.props,i=c.parent,s=i.type,l=i.id,m=c.conversationId,u=c.addComment,d=c.isAnchorComments;return u({parentType:s,parentId:l,content:t,replyTo:n,conversationId:m,rootCommentId:a,isConversation:r,replyType:It({id:a,replyTo:n,isConversation:r}).type,isAnchorComments:d})},e.loadMoreAnchorComments=function(){var t=e.props,n=t.conversationId,o=t.topCommentsPaging,a=void 0===o?{}:o;(0,t.loadMoreAnchorComments)({conversationId:n,nextUrl:a.next})},e.createOnRef=Tt()((function(t){return function(n){var o=e.props.byComment;n&&o&&String(t)===String(o)&&(e.byCommentNode=n)}})),e.scrollToTarget=function(){var t=Object(D.a)(e),n=t.byCommentNode,o=t.listEl;if(o&&n){var a=n.getBoundingClientRect(),r=a.top,c=a.height,i=o.getBoundingClientRect(),s=i.top,l=i.height;e.listEl.scrollTop+=r-s-(l-c)/2,n.classList.add("CommentItemV2--highlighted"),setTimeout((function(){return n.classList.remove("CommentItemV2--highlighted")}),2e3),n.tabIndex=-1,n.focus()}},e}return Object(r.a)(n,[{key:"componentDidMount",value:function(){this.props.byComment&&this.scrollToTarget()}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"render",value:function(){var e=this,t=this.props,n=t.onItemLike,o=t.onItemDelete,a=t.onItemFeature,r=t.onItemApprove,c=t.onItemCollapse,i=t.onItemDislike,s=t.onNavBack,u=t.canOperateItem,d=t.isFetching,p=t.comments,h=void 0===p?[]:p,b=t.commentNeedsReview,f=t.openComment.collapsed,v=t.parent,C=t.commentPattern,O=t.totals,j=t.isDrained,g=t.isPrevDrained,R=t.isConversationMoreFetching,k=t.isConversationMoreDrained,I=t.offsetIndex,N=null;return d&&!h.length?N=Object(l.c)(l.a,{children:[Object(l.b)(y.a,{className:"CommentItemV2",small:!0}),Object(l.b)("div",{className:"CommentsV2-openComment-divider"}),Object(l.b)("div",{className:"CommentsV2-replyNum",children:"".concat(O," 条回复")})]}):h.length&&(N=h.map((function(t,s){return s?k||s!==I||R?R&&s===I?Object(l.c)(m.Fragment,{children:[Object(l.b)(Ct,{onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:b,canOperate:u,parent:v,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:r,onCollapse:c,onDislike:i,collapsedShown:f,onReply:e.addComment},t.id),Object(l.b)(y.a,{className:"NestCoomment-moreCommentButton ",small:!0},"NestCoomment-moreCommentButton-PlaceHolder")]},t.id):Object(l.b)(Ct,{onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:b,canOperate:u,parent:v,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:r,onCollapse:c,onDislike:i,collapsedShown:f,onReply:e.addComment},t.id):Object(l.c)(m.Fragment,{children:[Object(l.b)(Ct,{onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:b,canOperate:u,parent:v,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:r,onCollapse:c,onDislike:i,collapsedShown:f,onReply:e.addComment},t.id),Object(l.c)("div",{role:"button",tabIndex:0,preset:"plain",className:"NestCoomment-moreCommentButton",onClick:e.loadMoreAnchorComments,children:[Object(l.b)(xt.a,{}),Object(l.b)("p",{children:"点击查看更多回复"})]},"NestCoomment-moreCommentButton")]},t.id):Object(l.c)(m.Fragment,{children:[Object(l.b)("div",{className:"CommentsV2-openComment",children:Object(l.b)(Ct,{onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:b,canOperate:u,parent:v,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:r,onCollapse:c,onDislike:i,collapsedShown:f,onReply:e.addComment},t.id)}),Object(l.b)("div",{className:"CommentsV2-openComment-divider"}),Object(l.b)("div",{children:Object(l.b)("div",{className:"CommentsV2-replyNum",children:"".concat(O," 条回复")})},"".concat(t.id,"-title"))]},t.id)}))),"bottom"===C?Object(l.b)(Ie.b,{size:"fullPage",onClose:s,children:Object(l.c)("div",{className:"CommentsV2",children:[Object(l.b)(Fe.a,{isConversation:!0,commentPattern:C}),Object(l.b)(y.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:d,isDrained:j,isPrevDrained:g,onLoad:this.load,placeholder:Object(l.b)(y.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e},children:N})]})}):Object(l.c)("div",{className:"CommentsV2",children:[Object(l.b)(Fe.a,{isConversation:!0,onNavBack:s}),Object(l.b)(y.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:d,isDrained:j,isPrevDrained:g,onLoad:this.load,placeholder:Object(l.b)(y.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e},children:N})]})}}]),n}(m.Component);Dt.propTypes={conversationId:p.a.oneOfType([p.a.number,p.a.string]),type:p.a.string,parent:p.a.object.isRequired,commentNeedsReview:p.a.bool},Dt.contextTypes={currentUser:p.a.object,authRequired:p.a.func.isRequired};var Mt=Object(f.compose)(Object(b.connect)((function(e,t){var n=t.conversationId,o=t.isAnchorComments,a=e.entities.comments,r=e.commentsV2,c=r.conversation,i=r.conversationMore,s=c[n]||{isFetching:!1,isDrained:!1,isPrevDrained:!1,ids:[]},l=s.isFetching,m=s.isDrained,u=s.isPrevDrained,d=s.ids,p=s.totals,h=s.topComments,b=(h=void 0===h?{}:h).paging,f=(b||{}).isEnd,v=i[n]||{isFetching:!1,isDrained:!1,ids:[]},C=v.isFetching,O=v.isDrained,j=v.ids,g=j.map((function(e){return a[e]})),y=d.map((function(e){return a[e]})),R=a["".concat(n,"_featured")]||a[n]||{};return{isFetching:l,isDrained:m,isPrevDrained:u,totals:p,comments:o?Lt()(j.length?[].concat(Object(z.a)(y.slice(0,4)),Object(z.a)(g),Object(z.a)(y.slice(4))):y,"id"):[R].concat(Object(z.a)(y)),openComment:R,topCommentsPaging:b,isConversationMoreFetching:C,isConversationMoreDrained:f||O,offsetIndex:b?[].concat(Object(z.a)(y.slice(0,3)),Object(z.a)(g)).length:-1}}),{loadConversation:O.h,addComment:O.a,loadMoreAnchorComments:O.i}))(Dt),At=n(97),Vt=["className","containerClassName","parent","commentPattern","type","parent","needLoadCommentPermission"];function Ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(s.a)(e);if(t){var a=Object(s.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(i.a)(this,n)}}var _t=function(e){Object(c.a)(n,e);var t=Ft(n);function n(){var e;Object(a.a)(this,n);for(var o=arguments.length,r=new Array(o),c=0;c<o;c++)r[c]=arguments[c];return(e=t.call.apply(t,[this].concat(r))).state={openedCommentId:e.props.byComment,isAnchorComments:Boolean(e.props.byComment),status:"open",order:"normal"},e.commentsContainerRef=Object(m.createRef)(),e.showConversation=function(t){var n=t.commentId,o=t.isAnchorComments;e.setState({openedCommentId:n,isAnchorComments:o})},e.showComments=function(){var t=e.props,n=t.byComment,o=t.router;n&&o.replace("".concat(location.pathname).concat(location.search)),e.setState({openedCommentId:null,isAnchorComments:!1})},e.delete=function(t){var n=e.props,o=n.parent;return(0,n.deleteComment)(t,o.type,o.id)},e.feature=function(t){var n=e.props,o=n.parent,a=n.updateCommentFeatureStatus,r=n.notificationId;a({id:e.state.openedCommentId,commentId:t,parentId:o.id,parentType:o.type,notificationId:r})},e.like=function(t,n){var o=e.props,a=o.onItemLike,r=o.updateCommentLikeStatus;a&&a(t,n),r(t)},e.collapse=function(t){var n=e.props,o=n.parent;(0,n.updateCommentCollapsed)(t,o.type,o.id)},e.dislike=function(t){(0,e.props.updateCommentDisliked)(t)},e.approve=function(t){var n=e.props,o=n.parent,a=n.type;(0,n.approveComment)(t,o.type||a,o.id)},e.reject=function(t){var n=e.props,o=n.parent,a=n.type;(0,n.rejectComment)(t,o.type||a,o.id)},e.handleStatusChange=function(t){e.setState({status:t})},e.handleOrderChange=function(t,n){var o=e.props.onOrderChange;o&&o(t,n),e.setState({order:t})},e}return Object(r.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.commentsContainerRef.current)}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.containerClassName,a=e.parent,r=e.commentPattern,c=e.type,i=e.parent,s=(i=void 0===i?{}:i).commentPermission,m=i.relationship,u=void 0===m?{}:m,d=i.author,p=void 0===d?{}:d,h=e.needLoadCommentPermission,b=Object(o.default)(e,Vt),f=this.context.currentUser,v=void 0===u.isAuthor?f&&p.urlToken&&f.urlToken===p.urlToken:u.isAuthor,O="censor"===s&&!v,j="answer"===c||"article"===c,g=this.state,y=g.openedCommentId,R=g.isAnchorComments,k=g.status,I=g.order,N=y,w=Boolean(y&&"bottom"!==r);return Object(l.c)("div",{className:C()("Comments-container",n),ref:this.commentsContainerRef,children:[Object(l.b)(Pt,Object.assign(Object.assign({className:C()(t,{"CommentsV2--hidden":w})},b),{},{type:c,order:I,status:k,parent:a,commentPattern:r,commentNeedsReview:O,canOperateItem:j,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,byComment:N,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:h,isAuthor:v})),y&&Object(l.b)(Mt,Object.assign(Object.assign({},b),{},{parent:a,type:c,canOperateItem:j,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,onItemReject:this.reject,commentPattern:r,conversationId:y,onNavBack:this.showComments,byComment:N,isAnchorComments:R,commentNeedsReview:O,onShowConversation:this.showConversation}))]})}}]),n}(m.Component);_t.propTypes={type:p.a.string.isRequired,parent:p.a.object.isRequired,onOrderChange:p.a.func,onItemLike:p.a.func,isAuthor:p.a.bool,onMount:p.a.func},_t.defaultProps={type:"answer"},_t.contextTypes={currentUser:p.a.object,authRequired:p.a.func.isRequired};t.default=Object(f.compose)(Object(At.a)(null),h.withRouter,Object(b.connect)(null,{updateCommentLikeStatus:O.p,updateCommentFeatureStatus:O.o,deleteComment:O.e,updateCommentCollapsed:O.m,updateCommentDisliked:O.n,approveComment:O.b,rejectComment:O.l}))(_t)},1552:function(e,t,n){"use strict";n.r(t);var o,a=n(29),r=n(9),c=n(11),i=n(12),s=n(13),l=n(6),m=n(0),u=n(2),d=n.n(u),p=n(30),h=n(1),b=n(8),f=n(7),v=n.n(f),C=n(175),O=n(10),j=n(153),g=n.n(j),y=n(1164),R=n(111),k=n(92),I=n(1313),N=n(15),w=n(56),S=n(148),P=n(1221),E=n(39),T=n(62),B=n(149),L=n(590),x=n(115),z=n(14),D=n(63),M=n(52),A=n(102),V=n.n(A),F=n(46),_=n.n(F),q=n(67),U=n(129),H=n(334),G=n(45);function W(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(s.a)(this,n)}}var K=function(){return""},Y=function(e){Object(i.a)(n,e);var t=W(n);function n(e,o){var a;return Object(r.a)(this,n),(a=t.call(this,e,o)).initLocalComment=function(){var e=a.props,t=e.type,n=e.id;if(t&&n){var o=_.a.get("zhihu::comment_local_key")||[],r="".concat(t,"_").concat(n),c=o.find((function(e){return e.key===r})),i=c&&c.value;i&&a.setState({value:{toHTML:function(){return i}},hasNoContent:!1})}},a.saveLocalComment=function(e){var t=a.props,n=t.type,o=t.id;if(n&&o){var r=e?e.toHTML():a.state.value.toHTML(),c="".concat(n,"_").concat(o),i=(_.a.get("zhihu::comment_local_key")||[]).filter((function(e){return e.key!==c})),s=r?[].concat(Object(z.a)(i.slice(0,4)),[{key:c,value:r}]):i;_.a.set("zhihu::comment_local_key",s)}},a.handleChange=function(e){a.setState({value:e,hasNoContent:e.isEmpty})},a.handleCommentShow=a.context.authRequired((function(){a.setState({shown:!0}),a.hiddenInput.focus()})),a.handleCommentHide=function(){a.setState({shown:!1})},a.handleMobileComment=function(){a.onSubmit(),a.handleCommentHide()},a.focusInput=function(e){e.preventDefault(),a.input.focus()},a.onChange=a.handleChange.bind(Object(D.a)(a)),a.onFocus=a.handleFocus.bind(Object(D.a)(a)),a.onBlur=a.handleBlur.bind(Object(D.a)(a)),a.onSubmit=a.context.authRequired(a.handleSubmit.bind(Object(D.a)(a)),void 0,E.b),a.state={active:e.defaultActive,hasNoContent:!0,submitting:!1,shown:!1,value:{toHTML:K}},a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.initLocalComment()}},{key:"componentWillUnmount",value:function(){this.saveLocalComment()}},{key:"handleFocus",value:function(){this.setState({active:!0})}},{key:"handleBlur",value:function(){var e=this;setTimeout((function(){return e.setState({active:!1})}),100)}},{key:"handleSubmit",value:function(){var e=this,t=this.props,n=t.replyTo,o=t.onSubmit,a=t.onCancel,r=this.state.submitting,c=this.input.toHTML();if(c&&o&&!r){this.setState({submitting:!0}),this.saveLocalComment();var i=o(c,n);i.then?i.then((function(){a&&a(),e.input?(e.input.reset(),e.setState({value:{toHTML:K}},(function(){return e.saveLocalComment()}))):e.saveLocalComment({toHTML:K})})).finally((function(){e.setState({submitting:!1})})):(this.setState({submitting:!1}),a&&a(),this.input.reset()),O.a.trackEvent(this,{action:"Comment",element:"Button"})}}},{key:"renderInput",value:function(e){var t=this,n=e.placeholder,o=e.className,a=this.props.autoFocus;return Object(m.c)(h.Fragment,{children:[Object(m.b)(U.b,{keyMap:{FOCUS_COMMENT_INPUT:"shift+c"},handlers:{FOCUS_COMMENT_INPUT:this.focusInput}}),Object(m.b)(H.a,{className:v()("CommentEditor-input",o),defaultValue:this.state.value.toHTML(),allowMention:!0,allowPasteRichText:!1,autoFocus:Boolean(void 0)||a,outputBlockType:"div",ref:function(e){t.input=e},placeholder:n,onFocus:this.onFocus,onBlur:this.onBlur,onChange:this.onChange,onSubmit:this.onSubmit,minRows:5})]})}},{key:"render",value:function(){var e=this.props,t=e.replyTo,n=e.commentNeedsReview,a=e.className,r=(e.onClick,e.onCancel),c=e.ownerAuthorIsOrg,i=e.ownerAuthorIsBrand,s=(e.type,e.id,e.shouldOia,e.preset,e.commentStatus),l=this.state,u=l.active,d=l.hasNoContent,p=l.submitting,h=c?"机构":"作者",b={preset:"primary",color:"blue",children:"评论",disabled:d||p};if(t){var f=V()(o||(o=Object(x.a)(["回复","",""])),t.author.member.name,n?"，评论由".concat(h,"筛选后公开"):"");return Object(m.c)("div",{className:v()(a,"CommentEditor--inCommentItem",{"CommentEditor--active":u||!d}),children:[this.renderInput({placeholder:f}),Object(m.c)("div",{className:"CommentEditor-actions",children:[Object(m.b)(N.c,{preset:"plain",onClick:r,children:"取消"}),Object(m.b)(N.c,Object.assign(Object.assign({},b),{},{onClick:this.onSubmit}))]})]})}var C="写下你的评论...";n&&(C=i?"已开启预审评论，评论由品牌筛选后公开":c?"已开启预审评论，评论由机构筛选后公开":"评论由作者筛选后显示"),s&&!1===s.canComment&&(C=s.toast);v()(a,"CommentEditor--normal"),this.state.shown;return Object(m.c)("div",{className:v()(a,"CommentEditor--normal",{"CommentEditor--active":u||!d}),children:[this.renderInput({placeholder:C}),Object(m.b)(N.c,Object.assign(Object.assign({},b),{},{className:"CommentEditor-singleButton",onClick:this.onSubmit}))]})}}]),n}(h.Component);Y.contextTypes={authRequired:d.a.func},Y.defaultProps={defaultActive:!1,replyTo:null,inCommentItem:!1,autoFocus:!0,ownerAuthorIsOrg:!1,ownerAuthorIsBrand:!1},Y.propTypes={className:d.a.string,defaultActive:d.a.bool,replyTo:d.a.object,inCommentItem:d.a.bool,commentNeedsReview:d.a.bool,canComment:d.a.object,onCancel:d.a.func,onSubmit:d.a.func.isRequired};var J=Object(p.compose)(M.withRouter,Object(b.connect)((function(e){return{shouldOia:Object(G.shouldOiaSelector)(e)}})))(Y),X=(n(1167),n(1326)),Z=n(1444),Q=n(1107),$=n(1192),ee=n(1159),te=n(1536),ne=n(1152),oe=n(1195),ae=n(1160),re=(n(51),n(342),n(85)),ce=n(336),ie=n(421),se=n(416),le=n(167),me=n(597),ue=n(36),de=n(231),pe=n(232);function he(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(s.a)(this,n)}}var be=function(e){Object(i.a)(n,e);var t=he(n);function n(){var e;Object(r.a)(this,n);for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).state={reportModalShown:!1,isReplying:!1,collapsed:!0,guideShown:!1},e.getRedirectUrl=function(){var t=e.props.parent;switch(t.type){case"answer":return"/question/".concat(t.question.id,"/answer/").concat(t.id);case"article":return"https://zhuanlan.zhihu.com/p/".concat(t.id);default:return""}},e.like=e.context.authRequired((function(t){var n=e.props;(0,n.onLike)(n.comment.id,t)}),ue.L.like,E.b),e.dislike=e.context.authRequired((function(){var t=e.props;(0,t.onDislike)(t.comment.id)}),ue.L.like,E.b),e.delete=function(){var t=e.props;(0,t.onDelete)(t.comment.id)},e.feature=function(){var t=e.props;(0,t.onFeature)(t.comment.id)},e.collapse=function(){var t=e.props;(0,t.onCollapse)(t.comment.id)},e.approve=function(){var t=e.props;(0,t.onApprove)(t.comment.id)},e.showConversation=function(){var t=e.props;(0,t.onShowConversation)(t.comment.id)},e.startReply=e.context.authRequired((function(){var t=e.props,n=t.commentStatus,o=t.showNotification;n&&!1===n.canReply?o(n.toast,"red",E.b):e.setState({isReplying:!0})}),void 0,E.b),e.stopReply=function(){e.setState({isReplying:!1})},e.openReportModal=e.context.authRequired((function(){e.setState({reportModalShown:!0})})),e.closeReportModal=function(t){if(t){var n=t.result.payload,o=n&&n.message||n&&n.code&&"举报失败";t.commentDeleteResult&&!(t.commentDeleteResult.payload||{}).code?ce.b.showModal({reportText:o}):Object(le.b)(o||"举报成功")}e.setState({reportModalShown:!1})},e.handleExpand=function(){e.setState({collapsed:!1})},e.handleToggleGuide=function(){e.setState({guideShown:!e.state.guideShown})},e.handleDelete=function(){return e.setState({deleteModal:!0})},e.handleCloseDelete=function(){return e.setState({deleteModal:!1})},e}return Object(c.a)(n,[{key:"renderRoleInfo",value:function(e,t){return"normal"===e?null:Object(m.b)("span",{className:"CommentItem-roleInfo",children:"ancestor"===e||"author"===e&&"question"===t?" (提问者) ":" (作者) "})}},{key:"renderReplyTo",value:function(){var e=this.props.comment,t=e.replyToAuthor,n=e.resourceType;if(!t)return null;var o=t.member,a=void 0===o?{}:o,r=t.role;return Object(m.c)("span",{children:[Object(m.b)("span",{className:"CommentItem-reply",children:"回复"}),Object(m.b)(se.a,{className:v()({"CommentItem-userLink":void 0}),noBadge:!0,noHoverCard:!0,user:a}),this.renderRoleInfo(r,n)]})}},{key:"renderInner",value:function(){var e=this,t=this.props,n=t.comment,o=n.isDelete,a=n.collapsed,r=t.isConversation,c=t.ownerAuthorIsOrg;if(o)return r?Object(m.b)("div",{className:"CommentItem-deletedContent",children:"这里有一条已删除的评论"}):null;if(a&&r&&this.state.collapsed)return Object(m.c)("div",{className:"CommentItem-deletedContent",children:["这里有一条已折叠的评论，",Object(m.b)(N.c,{preset:"plain",onClick:this.handleExpand,children:"查看"})]});var i,s=this.state,l=s.reportModalShown,u=s.isReplying,d=this.props,p=d.parent,h=p.canComment,b=(h=void 0===h?{status:!0}:h).status,f=p.questionType,C=d.commentNeedsReview,O=d.comment,j=d.onReply,g=d.status,y=d.type,R=d.canOperate,k=d.commentPattern,I=d.isMobile,w=O.id,S=O.author,P=O.content,E=O.voteCount,T=O.replyToAuthor,B=O.isAuthor,L=O.isParentAuthor,x=O.createdTime,z=O.featured,D=O.voting,M=O.reviewing,A=O.disliked,V=O.resourceType,F=O.collapsedReason,_=void 0===F?"":F,q=S||{},U=q.member,H=q.role;if(u)i=Object(m.b)(J,{type:"comment",id:w,commentNeedsReview:C,className:"CommentItem-editor",defaultActive:!0,replyTo:O,onCancel:this.stopReply,onSubmit:j});else if("reviewing"===g)i=Object(m.c)("div",{className:"CommentItem-footer",children:[Object(m.c)(N.c,{preset:"plain",onClick:this.approve,children:[Object(m.b)(X.a,{style:{marginRight:5},center:!0,size:14}),"公开"]}),Object(m.c)(N.c,{className:v()({"CommentItem-hoverBtn":!0}),preset:"plain",onClick:this.handleDelete,children:[Object(m.b)(Z.a,{style:{marginRight:5},center:!0,size:16}),"删除"]})]});else{var G=B||L&&("question"!==y||"commercial"===f);i=Object(m.c)("div",{className:v()("CommentItem-footer",{"CommentItem-mobileFooter":void 0}),children:[Object(m.c)(N.c,{className:v()("CommentItem-likeBtn",D&&"is-liked"),preset:"plain",onClick:this.like,disabled:B||!b,children:[Object(m.b)(Q.a,{style:{marginRight:5},center:!0,size:16}),E>0?E:"赞"]}),a&&_&&Object(m.c)("div",{className:"CommentItem-walleTag",children:["阴阳怪气自动折叠"===_&&Object(m.b)($.a,{size:16,className:"CommentItem-walleIcon"}),_]}),!r&&T&&Object(m.c)(N.c,{preset:"plain",className:"CommentItem-talkBtn",onClick:this.showConversation,children:[Object(m.b)(ee.a,{style:{marginRight:5},center:!0,size:16}),"查看对话"]}),!r&&!B&&b&&!a&&Object(m.c)(N.c,{preset:"plain",className:v()({"CommentItem-hoverBtn":!0}),onClick:this.startReply,children:[Object(m.b)(te.a,{style:{marginRight:5},center:!0,size:16}),"回复"]}),L&&R&&!I&&Object(m.c)(N.c,{className:v()({"CommentItem-hoverBtn":!B}),preset:"plain",onClick:this.feature,children:[Object(m.b)(ne.a,{style:{marginRight:5},center:!0,size:16}),z?"取消推荐":"推荐"]}),L&&R&&!I&&Object(m.c)(N.c,{className:v()({"CommentItem-hoverBtn":!B}),preset:"plain",onClick:this.collapse,children:[Object(m.b)(oe.a,{style:{marginRight:5},center:!0,size:14}),a?"取消折叠":"折叠"]}),!L&&!B&&R&&!I&&Object(m.c)(N.c,{className:v()({"CommentItem-hoverBtn":!0}),preset:"plain",onClick:this.dislike,children:[Object(m.b)(Q.a,{style:{transform:"rotate(180deg)",marginRight:5},size:16,center:!0}),A?"取消踩":"踩"]}),B||Object(m.c)(N.c,{className:v()({"CommentItem-hoverBtn":!0}),preset:"plain",onClick:this.openReportModal,children:[Object(m.b)(ae.a,{style:{marginRight:5},center:!0,size:16}),"举报"]}),G&&Object(m.c)(N.c,{className:v()({"CommentItem-hoverBtn":!B}),preset:"plain",onClick:this.handleDelete,children:[Object(m.b)(Z.a,{style:{marginRight:5},center:!0,size:16}),"删除"]}),void 0,void 0,Object(m.b)(ce.a,{shown:this.state.deleteModal,id:w,onDelete:this.delete,onClose:this.handleCloseDelete}),Object(m.b)(de.a,Object.assign(Object.assign({type:"comment",urlToken:w,shown:l,onClose:this.closeReportModal},G&&{onDeleteComment:function(){return e.props.onDelete(w)}}),{},{notification:{failure:me.a},zaEnabled:!0}))]})}return Object(m.c)("div",{children:[Object(m.c)("div",{className:"CommentItem-meta",children:[U&&Object(m.b)(ie.a,{className:"CommentItem-avatar",noHoverCard:"fixed"===k,user:U}),U&&Object(m.b)(se.a,{className:v()({"CommentItem-userLink":void 0}),noBadge:!0,noHoverCard:!0,user:U}),this.renderRoleInfo(H,V),this.renderReplyTo(),M&&Object(m.b)(oe.a,{className:"CommentItem-reviewing","data-tooltip":"".concat(!1===c?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开"),"aria-label":"".concat(!1===c?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开"),center:!0,size:14}),Object(m.b)("span",{className:"CommentItem-time",children:Object(re.toRelativeString)(x)})]}),Object(m.b)(pe.a,{className:"CommentItem-content",html:P}),i]})}},{key:"render",value:function(){var e=this.renderInner(),t=this.props,n=t.parent;n.type,n.id,t.isWechat;return e&&Object(m.c)("div",{className:"CommentItem",ref:this.props.onRef,children:[e,void 0]})}}]),n}(h.PureComponent);be.propTypes={comment:d.a.object.isRequired,parent:d.a.object.isRequired,commentNeedsReview:d.a.bool,type:d.a.string,isConversation:d.a.bool,onLike:d.a.func.isRequired,onShowConversation:d.a.func,onReply:d.a.func,onFeature:d.a.func,onDelete:d.a.func.isRequired,onCollapse:d.a.func,commentPattern:d.a.string,isMobile:d.a.bool},be.contextTypes={currentUser:d.a.object,authRequired:d.a.func};var fe=Object(p.compose)(M.withRouter,Object(b.connect)((function(e){return{isWechat:e.env.userAgent.Wechat,shouldSpecialOia:Object(G.shouldSpecialOiaSelector)(e)}}),{showNotification:E.g}))(be),ve=n(1316),Ce=n(1239),Oe=n(1317);function je(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(s.a)(this,n)}}function ge(e,t){switch(e){case"answer":return Object(T.k)(t);case"article":return Object(B.c)(t);default:return null}}var ye=function(e){Object(i.a)(n,e);var t=je(n);function n(){var e;Object(r.a)(this,n);for(var o=arguments.length,a=new Array(o),c=0;c<o;c++)a[c]=arguments[c];return(e=t.call.apply(t,[this].concat(a))).state={collapsed:!0,current:1},e.commentsWithPaginationElRef=Object(h.createRef)(),e.load=function(t,n,o){if(!e.props.isFetching&&!e.props.parent.adminClosedComment){var a=t||e.props,r=a.order,c=a.byComment,i=a.status,s=a.parent,l=s.id,m=s.type,u=a.dispatch,d=a.commentPattern;if(a.needLoadCommentPermission&&ge(m,l)&&u(ge(m,l)),o){u(Object(C.e)(m,l,{order:r,isPrevious:n,byComment:c,status:"collapsed",commentPattern:d},!0))}else u(Object(C.e)(m,l,{order:r,isPrevious:n,byComment:c,status:i,commentPattern:d}))}},e.addComment=function(t,n){var o=e.props,a=o.parent,r=a.id,c=a.type,i=o.dispatch,s=[c,r,t];return n&&(s[3]=n.id),i(C.a.apply(void 0,s))},e.featureItem=function(t){e.props.onItemFeature(t,e.lastFeaturedIndex)},e.handleOpenCollapsed=function(){e.setState({collapsed:!1}),e.load(e.props,!1,!0)},e.createOnRef=g()((function(t){return function(n){var o=e.props.byComment;t===Number(o)&&(e.targetCommentEl=n)}})),e.handlePageSelect=function(t){var n=e.props.onPaginationClick,o=e.state.current;n&&n(o,t),e.commentsElement.scrollIntoView(),e.setState({current:t}),e.loadByPagination(t)},e.loadByPagination=function(t,n){var o=n||e.props,a=o.order,r=o.byComment,c=o.status,i=o.parent,s=i.id,l=i.type,m=o.dispatch,u=o.commentPattern;o.needLoadCommentPermission&&ge(l,s)&&m(ge(l,s)),m(Object(C.e)(l,s,{order:a,isPrevious:!1,byComment:r,status:c,commentPattern:u,current:t}))},e.renderComment=function(t){var n=e.props,o=n.parent,a=o.type,r=o.author,c=(r=void 0===r?{isOrg:!1}:r).isOrg,i=n.isMobile,s=n.parent,l=n.commentNeedsReview,u=n.onShowConversation,d=n.status,p=n.onItemLike,h=n.onItemDelete,b=n.onItemCollapse,f=n.onItemDislike,v=n.onItemApprove,C=n.canOperateItem,O=n.commentPattern;return Object(m.b)(fe,{isMobile:i,comment:t,onRef:e.createOnRef(t.id),status:d,type:a,parent:s,canOperate:C,commentNeedsReview:l,onShowConversation:u,ownerAuthorIsOrg:c,onLike:p,onReply:e.addComment,onFeature:e.featureItem,onDelete:h,onCollapse:b,onDislike:f,onApprove:v,commentPattern:O,commentStatus:s.commentStatus},t.id)},e.renderNormalComments=function(t){var n=e.state.collapsed,o=e.props.byComment,a=[];if(e.lastFeaturedIndex=0,t.length>0){var r=t[0].featured,c=!1;t.forEach((function(i,s){if(o||!i.collapsed){var l=t[s-1];if(!i.collapsed||(l&&l.collapsed||a.push(e.renderCollapsedDivider()),!n)){a.push(e.renderComment(i));var u=t[s+1];r&&!c&&i.featured&&(!u||!u.featured)&&(c=!0,e.lastFeaturedIndex=s,a.push(Object(m.c)("div",{className:"CommentList-divider",children:[Object(m.b)("div",{className:"CommentList-dividerLine"}),Object(m.c)("div",{className:"CommentList-dividerText",children:["以上为精选评论",Object(m.b)(y.a,{className:"CommentList-questionMark","data-tooltip":"精选评论包含回答作者推荐的评论和部分高赞评论","aria-label":"精选评论包含回答作者推荐的评论和部分高赞评论",center:!0,size:16})]})]},"divider-featured")))}}}))}return a},e.renderCollapsedComments=function(){var t=[],n=e.props.collapsedComments;return e.state.collapsed||!n||n.length<=0?[]:(t.push(n.map((function(t){return e.renderComment(t)}))),t)},e.renderComments=function(t){return t.map(e.renderComment)},e.renderCollapsedDivider=function(){var t=e.props,n=t.isDrained,o=t.parent.collapsedCounts;return!n||o<=0?[]:e.state.collapsed?Object(m.b)("div",{className:"CommentList-action",children:Object(m.c)("div",{className:"CommentList-expendCollapseButton",children:[Object(m.c)("span",{role:"button",tabIndex:0,onClick:e.handleOpenCollapsed,children:[Object(w.formatNumber)(o)," 条评论被折叠"]}),"（",Object(m.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer",children:"为什么？"}),"）"]})},"collapsed"):Object(m.c)("div",{className:"CommentList-divider",children:[Object(m.b)("div",{className:"CommentList-dividerLine"}),Object(m.c)("div",{className:"CommentList-dividerText",children:[Object(w.formatNumber)(o)," 条评论被折叠（",Object(m.b)("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer",children:"为什么？"}),"）"]})]},"divider-collapsed")},e.renderCollapsedInfiLoader=function(){var t=e.state.collapsed;if(t)return[];var n=e.props.collapsedInfo,o=(n=void 0===n?{}:n).isFetching,a=n.isPrevDrained,r=n.isDrained;return Object(m.b)(k.b,{className:"CommentList",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:o,isPrevDrained:a,isDrained:r,onLoad:function(n){return e.load(e.props,n,!t)},placeholder:Object(m.b)(k.a,{className:"CommentItem",small:!0}),children:e.renderCollapsedComments()})},e.renderPatternContent=function(t){var n=e.props,o=n.isFetching,a=n.parent.adminClosedComment,r=n.byComment,c=n.status,i=n.order,s=n.totals,l=n.showPackupButton,u=n.handlePackupButton,d=Math.ceil(s/20),p=e.state.current;return a?null:o?Object(m.b)(ve.a,{}):Object(m.c)("div",{ref:e.commentsWithPaginationElRef,children:[Object(m.b)("div",{className:"CommentList",children:"normal"===i&&"open"===c?e.renderNormalComments(t):e.renderComments(t)}),d>1&&Object(m.b)(I.a,{className:"comments-pagination",current:p,total:d,onSelect:e.handlePageSelect}),!r&&e.renderCollapsedDivider(),!r&&e.renderCollapsedInfiLoader(),l&&Object(m.b)(Oe.a,{onClick:u,commentsElRef:e.commentsWithPaginationElRef})]})},e.renderModalContent=function(t){var n=e.props,o=n.collapsedInfo,a=n.parent.adminClosedComment,r=n.status,c=n.order,i=n.byComment,s=e.state.collapsed,l=s?e.props:o,u=l.isFetching,d=l.isDrained,p=l.isPrevDrained;if(d&&t.length<=0||a)return Object(m.b)("div",{className:"Comments-empty",children:Object(m.c)(L.d,{children:[Object(m.b)(L.a,{}),Object(m.b)("div",{children:"还没有评论"})]})});var h={getContainer:function(e){return e}};return Object(m.c)(k.b,Object.assign(Object.assign({className:"CommentList",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:u,isPrevDrained:p,isDrained:d,onLoad:function(t){return e.load(e.props,t,!s)},placeholder:Object(m.b)(k.a,{className:"CommentItem",small:!0})},h),{},{children:["normal"===c&&"open"===r?e.renderNormalComments(t):e.renderComments(t),!i&&e.renderCollapsedDivider(),!i&&e.renderCollapsedComments()]}))},e.renderCommentEdit=function(t){var n=e.props,o=n.parent,a=o.canComment,r=(a=void 0===a?{status:!0}:a).status,c=a.reason,i=o.author,s=(i=void 0===i?{isOrg:!1}:i).isOrg,l=o.type,u=o.id,d=o.adminClosedComment,p=o.questionType,h=o.commentStatus,b=n.byComment,f=n.autoFocus,C=n.commentNeedsReview,j=n.showNotification,g=d?"当前内容暂时无法评论":c,y=f&&!b,R=h&&!1===h.canComment;return r&&!d?Object(m.c)("div",{className:"Comments-footer-wrapper",children:[Object(m.b)(J,Object.assign({className:"Comments-".concat("top"===t?"top":"footer"),type:l,id:u,commentNeedsReview:C,commentStatus:h,onSubmit:e.addComment,autoFocus:y,ownerAuthorIsOrg:s,ownerAuthorIsBrand:"commercial"===p},"top"===t&&{preset:"default",onClick:function(e){O.a.trackEvent(e.target,{id:3905})}})),R&&Object(m.b)("div",Object.assign({},Object(P.a)((function(){j(h.toast,"red",E.b)}),{className:"Comments-footer-disabled"})))]}):"top"!==t&&Object(m.b)("div",{className:v()("Comments-disabledText",{"Comments-disabledText--fixed":void 0}),children:Object(m.b)("div",{className:"Comments-disabledReason",children:g})})},e.renderBottomButton=function(){var t=e.props.params,n=t.id,o=t.answerId,a=Boolean(o);return Object(m.b)("div",{className:"Comments-footer CommentEditor--normal",children:Object(m.b)(N.c,{className:"CommentEditor-startCommentButton",preset:"primary",color:"blue",onClick:function(){return Object(R.e)(Object(S.a)(a?{type:"answer",id:o}:{type:"question",id:n},{utm_content:"comment_area"}),{zaProps:{id:3906}})},children:"打开 App 参与站内讨论"})})},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this.props,t=e.byComment,n=e.commentPattern,o=e.parent.adminClosedComment,a=this.state.current;t&&this.scrollToTarget(),"bottom"!==n||o||this.loadByPagination(a)}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,a=t.targetComment,r=t.commentPattern;n===e.order&&o===e.status||("bottom"===r?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var c=e.targetComment;!a&&c&&this.setState({collapsed:!c.collapsed})}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Object(E.d)(E.b))}},{key:"scrollToTarget",value:function(){var e=this.targetCommentEl,t=this.listEl;if(t&&e){var n=e.getBoundingClientRect(),o=n.top,a=n.height,r=t.getBoundingClientRect(),c=r.top,i=r.height;this.listEl.scrollTop+=o-c-(i-a)/2,e.classList.add("CommentItem--highlighted"),setTimeout((function(){return e.classList.remove("CommentItem--highlighted")}),2e3),e.tabIndex=-1,e.focus()}}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.isAuthor,a=t.comments,r=t.commentPattern,c=t.commentInputPosition,i=t.parent,s=i.author,l=(s=void 0===s?{isOrg:!1}:s).isOrg,u=i.commentPermission,d=i.reviewingCounts,p=i.commentCount,h=i.adminClosedComment,b=t.totals,f=t.status,C=t.order,O=t.onStatusChange,j=t.onOrderChange,g=t.targetLink,y=a.filter((function(e){return!e.isDelete})),R="censor"===u&&o,k=R?{isCommentReviewer:R,onStatusChange:O,status:f,reviewingCounts:d}:{status:f},I=v()({Comments:!0,"Comments--withEditor":!0,"Comments-withPagination":"bottom"===r},n);return Object(m.c)("div",{className:I,ref:function(t){e.commentsElement=t},children:[Object(m.b)(Ce.a,Object.assign({commentCount:void 0!==p?p:b,commentClosed:h,targetLink:g,order:C,onOrderChange:j,commentPattern:r,isOrg:l,options:this.renderCommentEdit("top")},k)),"top"===c&&this.renderCommentEdit(),"bottom"===r?this.renderPatternContent(y):this.renderModalContent(y),"bottom"===c&&this.renderCommentEdit()]})}}]),n}(h.Component);ye.propTypes={type:d.a.string,parent:d.a.object.isRequired,targetLink:d.a.node,commentNeedsReview:d.a.bool,byComment:d.a.oneOfType([d.a.number,d.a.string]),commentPattern:d.a.string,commentInputPosition:d.a.oneOf(["top","bottom"]),showPackupButton:d.a.bool,handlePackupButton:d.a.func,onPaginationClick:d.a.func,autoFocus:d.a.bool},ye.contextTypes={authRequired:d.a.func.isRequired},ye.defaultProps={commentInputPosition:"bottom",showPackupButton:!0,autoFocus:!0};var Re=Object(b.connect)((function(e,t){var n=t.parent,o=t.parent,a=o.type,r=o.id,c=t.status,i=t.order,s=t.byComment,l=t.commentPattern,m=e.entities,u=e.comments,d="".concat(a,"_").concat(r),p=u.parent,h=u.pagination;"reviewing"===c&&(h=u.reviewing),"reverse"===i&&"open"===c&&(h=u.reverse);var b=[],f=u.collapsed[d]||{};f.ids&&f.ids.length>0&&(b=f.ids.map((function(e){return m.comments[e]})));var v=h[d]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},C=v.isFetching,O=v.isPrevDrained,j=v.isDrained,g=v.ids,y=v.newIds,R=void 0===y?[]:y;return{isFetching:C,isPrevDrained:O,isDrained:j,totals:v.totals,comments:("bottom"!==l?g:R).map((function(e){return m.comments[e]})),collapsedInfo:f,collapsedComments:b,targetComment:m.comments[s],parent:Object.assign(Object.assign({},n),p[d])}}),{showNotification:E.g})(ye);function ke(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(s.a)(this,n)}}var Ie=function(e){Object(i.a)(n,e);var t=ke(n);function n(e,o){var a;return Object(r.a)(this,n),(a=t.call(this,e,o)).load=a.load.bind(Object(D.a)(a)),a.addComment=o.authRequired(a.addComment.bind(Object(D.a)(a)),void 0,E.b),a}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.props.dispatch(Object(C.f)(this.props.commentId))}},{key:"addComment",value:function(e,t){var n=this.props,o=n.parent,a=o.type,r=o.id,c=n.commentId,i=n.dispatch,s=[a,r,e,t.id,c];return i(C.a.apply(void 0,s))}},{key:"render",value:function(){var e,t,n,o=this.props,a=o.onItemLike,r=o.onItemDelete,c=o.onItemFeature,i=o.onItemApprove,s=o.onItemCollapse,l=o.onItemDislike,u=o.onNavBack,d=o.canOperateItem,p=o.isFetching,h=o.comments,b=o.commentNeedsReview,f=o.openComment.collapsed,v=o.parent,C=o.parent.canComment,O=(C=void 0===C?{status:!0}:C).status,j=C.reason,g=o.commentPattern,y=o.commentId,R=this.context.currentUser;return Boolean(R&&h.find((function(e){return e.author&&e.author.member.urlToken===R.urlToken})))&&(t=(e=h.filter((function(e){return e.author&&e.author.member.urlToken!==R.urlToken})))[e.length-1]),p&&!h.length?n=Object(m.b)(k.a,{className:"CommentItem",small:!0}):h.length&&(n=h.map((function(e,t){return Object(m.b)(fe,{isConversation:!0,commentNeedsReview:b,canOperate:d,parent:v,comment:e,onLike:a,onDelete:r,onFeature:c,onApprove:i,onCollapse:s,onDislike:l,collapsedShown:f},t)}))),"bottom"===g?Object(m.b)(q.b,{size:"fullPage",onClose:u,children:Object(m.c)("div",{className:"Comments",children:[Object(m.b)(Ce.a,{isConversation:!0,commentPattern:g}),Object(m.b)("div",{className:"CommentList",children:n})]})}):Object(m.c)("div",{className:"Comments",children:[Object(m.b)(Ce.a,{isConversation:!0,onNavBack:u}),Object(m.b)("div",{className:"CommentList",children:n}),t&&(O?Object(m.b)(J,{id:y,type:"conversation",className:"Comments-footer",replyTo:t,commentNeedsReview:b,onSubmit:this.addComment}):Object(m.b)("div",{className:"Comments-disabledText",children:j}))]})}}]),n}(h.Component);Ie.propTypes={commentId:d.a.number.isRequired,type:d.a.string,parent:d.a.object.isRequired,commentNeedsReview:d.a.bool},Ie.contextTypes={currentUser:d.a.object,authRequired:d.a.func.isRequired};var Ne=Object(b.connect)((function(e,t){var n=t.commentId,o=e.entities.comments,a=e.comments.conversation[n]||{isFetching:!1,isDrained:!1,ids:[]};return{isFetching:a.isFetching,isDrained:a.isDrained,comments:a.ids.map((function(e){return o[e]})),openComment:o[n]}}))(Ie),we=n(97),Se=["className","containerClassName","parent","commentPattern","type","parent","needLoadCommentPermission"];function Pe(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Object(l.a)(e);if(t){var a=Object(l.a)(this).constructor;n=Reflect.construct(o,arguments,a)}else n=o.apply(this,arguments);return Object(s.a)(this,n)}}var Ee=function(e){Object(i.a)(n,e);var t=Pe(n);function n(e){var o;Object(r.a)(this,n),(o=t.call(this,e)).state={openedCommentId:null,status:"open",order:"normal"},o.like=function(e,t){var n=o.props,a=n.onItemLike,r=n.dispatch;a&&a(e,t),r(Object(C.j)(e))},o.collapse=function(e){var t=o.props,n=t.dispatch,a=t.parent;n(Object(C.g)(e,a.type,a.id))},o.dislike=function(e){return o.props.dispatch(Object(C.h)(e))},o.approve=function(e){var t=o.props,n=t.dispatch,a=t.parent,r=t.type;n(Object(C.b)(e,a.type||r,a.id))},o.handleStatusChange=function(e){o.setState({status:e})},o.handleOrderChange=function(e,t){o.props.onOrderChange&&o.props.onOrderChange(e,t),o.setState({order:e})};var a=e.parent,c=e.dispatch;return o.feature=function(e,t){return c(Object(C.i)(e,a.id,a.type,t))},o.delete=function(e){return c(Object(C.d)(e,a.type,a.id))},o.showConversation=function(e){return o.setState({openedCommentId:e})},o.showComments=function(){return o.setState({openedCommentId:null})},o}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.domNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.containerClassName,r=t.parent,c=t.commentPattern,i=t.type,s=t.parent,l=(s=void 0===s?{}:s).commentPermission,u=s.relationship,d=void 0===u?{}:u,p=s.author,h=void 0===p?{}:p,b=t.needLoadCommentPermission,f=Object(a.default)(t,Se),C=this.context.currentUser,O=void 0===d.isAuthor?C&&h.urlToken&&C.urlToken===h.urlToken:d.isAuthor,j="censor"===l&&!O,g="answer"===i||"article"===i,y=this.state,R=y.openedCommentId,k=y.status,I=y.order,N={commentNeedsReview:j,parent:r,type:i,canOperateItem:g,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve};return Object(m.c)("div",{className:v()("Comments-container",o),ref:function(t){return e.domNode=t},children:[Object(m.b)(Re,Object.assign(Object.assign(Object.assign({},f),N),{},{commentPattern:c,className:v()(n,{"Comments--hidden":R&&"bottom"!==c}),order:I,status:k,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:b,isAuthor:O})),R&&Object(m.b)(Ne,Object.assign(Object.assign(Object.assign({},f),N),{},{commentPattern:c,commentId:R,onNavBack:this.showComments}))]})}}]),n}(h.Component);Ee.propTypes={type:d.a.string.isRequired,parent:d.a.object.isRequired,onOrderChange:d.a.func,onItemLike:d.a.func,isAuthor:d.a.bool,onMount:d.a.func},Ee.defaultProps={type:"answer"},Ee.contextTypes={currentUser:d.a.object,authRequired:d.a.func.isRequired};t.default=Object(p.compose)(Object(b.connect)(),Object(we.a)(null))(Ee)}}]);
//# sourceMappingURL=column.comments-modals.ca32ee15b8f6f187a37d.js.map